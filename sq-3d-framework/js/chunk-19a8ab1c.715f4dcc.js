(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19a8ab1c"],{"04de":function(e,t,n){"use strict";n("1ecf")},"08fd":function(e,t,n){var r={"./GlassFrontShader/F.glsl":"f430"};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id="08fd"},1148:function(e,t,n){"use strict";var r=n("da84"),i=n("5926"),o=n("577e"),a=n("1d80"),s=r.RangeError;e.exports=function(e){var t=o(a(this)),n="",r=i(e);if(r<0||r==1/0)throw s("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}},"1ecf":function(e,t,n){},"38cf":function(e,t,n){var r=n("23e7"),i=n("1148");r({target:"String",proto:!0},{repeat:i})},"44ec":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{ref:"canvas-container",attrs:{id:"canvas-container"}})])},i=[],o=n("2b0e"),a=n("d4ec"),s=n("bee2"),c=n("ade3"),l=(n("d3b7"),n("159b"),n("38cf"),n("4c53"),n("5a89")),h=n("32d9"),d=n("93e9"),u=n("61d9"),f=n("232b"),v=n("26e3"),p=n("7d52"),w=n("7612"),g=n("f998"),m=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;Object(a["a"])(this,e),Object(c["a"])(this,"container",void 0),Object(c["a"])(this,"renderer",void 0),Object(c["a"])(this,"camera",void 0),Object(c["a"])(this,"cardInsideScene",void 0),Object(c["a"])(this,"scene",void 0),Object(c["a"])(this,"composer",void 0),Object(c["a"])(this,"stats",void 0),Object(c["a"])(this,"refractionManager",void 0),Object(c["a"])(this,"glassMesh1Controller",void 0),Object(c["a"])(this,"mousePosX",void 0),Object(c["a"])(this,"mousePosY",void 0),Object(c["a"])(this,"pointer",void 0),Object(c["a"])(this,"cameraZPosition",void 0),Object(c["a"])(this,"cameraPositionController",void 0),Object(c["a"])(this,"cameraTargetPosition",void 0),Object(c["a"])(this,"cursorLightGroup",void 0),Object(c["a"])(this,"cursorLight",void 0),Object(c["a"])(this,"cursorLightController",void 0),Object(c["a"])(this,"raycaster",void 0),Object(c["a"])(this,"intersectTardisCardObjs",void 0),Object(c["a"])(this,"intersectGlassObjs",void 0),Object(c["a"])(this,"glassSelected",void 0),Object(c["a"])(this,"glassIsRotating",void 0),Object(c["a"])(this,"animate",(function(){requestAnimationFrame(n.animate),n.updatecornerObject(),n.updateCamera(),n.updateCursorLight(),n.render(),n.stats.update()})),this.cameraZPosition=r,this.container=t,this.camera=new l["E"](45,window.innerWidth/window.innerHeight,1,5e3),this.cameraTargetPosition=new l["X"](0,0,this.cameraZPosition),this.camera.position.copy(this.cameraTargetPosition),this.camera.lookAt(0,0,0),this.renderer=new l["ab"]({alpha:!0}),this.renderer.setClearColor(16777215),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.container.appendChild(this.renderer.domElement),this.stats=new u["Stats"],this.stats.domElement.style.zIndex="100",this.container.appendChild(this.stats.domElement),this.scene=new l["N"],this.cardInsideScene=new l["N"];var i="./cube1/",o=[i+"px.jpg",i+"nx.jpg",i+"py.jpg",i+"ny.jpg",i+"pz.jpg",i+"nz.jpg"],s=(new l["h"]).load(o);s.mapping=l["g"],this.scene.environment=s;var g=new l["k"];g.position.x=300,g.position.y=200,g.position.z=100,this.scene.add(g),this.refractionManager=new p["a"](this.scene,this.container,this.renderer,this.camera);var m=new l["y"](new w["a"](40,40,40,5,5),new l["A"]({}));m.rotation.set(1,1,1),this.refractionManager.addRefractionMesh(m,!0,new l["f"](0),1.5),this.glassMesh1Controller=new v["a"](m,.2,.1);var b=new d["a"](this.scene,this.camera);b.clear=!0;var y=new d["a"](this.cardInsideScene,this.camera);y.clearDepth=!0,y.clear=!1,this.composer=new h["a"](this.renderer,new l["Y"](this.container.offsetWidth*window.devicePixelRatio,this.container.offsetHeight*window.devicePixelRatio)),this.composer.addPass(b),this.composer.addPass(y),this.composer.renderTarget1.stencilBuffer=!0,this.composer.renderTarget2.stencilBuffer=!0,this.refractionManager.scene.background=this.composer.renderTarget2.texture;var x=new f["a"](200,200,111,this.scene,this.cardInsideScene,new l["X"](0,0,0),new l["n"]),j=new l["y"](new l["T"](20,10,20,20),new l["B"]({color:new l["f"](16777215)})),P=(new l["S"]).load("./tiles/diffuse.jpg"),k=(new l["S"]).load("./tiles/normal.jpg"),C=(new l["S"]).load("./tiles/specular.jpg"),O=[P,k,C];O.forEach((function(e){e.wrapS=e.wrapT=l["L"],e.repeat.set(2,2)}));var R=new l["y"](new l["F"](400,400,1,1),new l["B"]({map:P,normalMap:k,normalScale:new l["W"](.1,.1),specularColorMap:C,specularIntensity:.2,reflectivity:1,metalness:.1,roughness:.2,clearcoat:.1,color:16768511}));R.position.set(0,0,-100);var M=new l["s"];M.add(j),M.add(R),M.position.copy(x.cardMesh.position),x.addVisibleObjectGroup(M);var S=new f["a"](100,100,112,this.scene,this.cardInsideScene,new l["X"](200,0,0),new l["n"],f["b"].CIRCLE),T=new l["y"](new l["T"](20,10,20,20),new l["B"]({color:new l["f"](16777215)})),z=(new l["S"]).load("./marble/diffuse.jpg"),F=(new l["S"]).load("./marble/normal.jpg"),D=(new l["S"]).load("./marble/specular.jpg");O=[z,F,D],O.forEach((function(e){e.wrapS=e.wrapT=l["L"],e.repeat.set(2,2)})),R=new l["y"](new l["F"](800,400,1,1),new l["B"]({map:z,normalMap:F,normalScale:new l["W"](.1,.1),specularColorMap:D,specularIntensity:4,reflectivity:1,metalness:.2,roughness:.1,clearcoat:.5})),R.position.set(0,0,-100);var _=new l["s"];_.add(T),_.add(R),_.position.copy(S.cardMesh.position),S.addVisibleObjectGroup(_);var L=new f["a"](100,100,113,this.scene,this.cardInsideScene,new l["X"](-200,0,0),new l["n"],f["b"].CIRCLE),W=new l["y"](new l["T"](20,10,20,20),new l["B"]({color:new l["f"](16777215)})),E=(new l["S"]).load("./tilecolor/diffuse.png"),X=(new l["S"]).load("./tilecolor/normal.png");O=[E,X],O.forEach((function(e){e.wrapS=e.wrapT=l["L"],e.repeat.set(4,4)})),R=new l["y"](new l["F"](400,400,1,1),new l["B"]({map:E,normalMap:X,normalScale:new l["W"](2,2),specularIntensity:4,reflectivity:.5,metalness:.3,roughness:.7})),R.position.set(0,0,-100);var I=new l["s"];I.add(W),I.add(R),I.position.copy(L.cardMesh.position),L.addVisibleObjectGroup(I),this.cursorLightGroup=new l["s"],this.cursorLight=new l["H"],this.cursorLight.intensity=1,this.cursorLight.decay=1,this.cursorLight.distance=200,this.cursorLight.color=new l["f"](11193599),this.cursorLightGroup.add(this.cursorLight),this.scene.add(this.cursorLightGroup),this.cursorLightController=new v["a"](this.cursorLightGroup,.3,.1),this.raycaster=new l["K"],this.intersectTardisCardObjs=[],this.intersectTardisCardObjs.push(x.cardMesh,S.cardMesh,L.cardMesh),this.intersectGlassObjs=[],this.glassSelected=null,this.glassIsRotating=!1,this.intersectGlassObjs.push(m),this.mousePosX=0,this.mousePosY=0,this.pointer=new l["W"];var N=this;window.addEventListener("resize",(function(){N.camera.aspect=window.innerWidth/window.innerHeight,N.camera.updateProjectionMatrix(),N.refractionManager.onWindowResize(),N.renderer.setSize(window.innerWidth,window.innerHeight),N.composer.setSize(window.innerWidth,window.innerHeight)})),window.addEventListener("click",(function(e){N.onClick(e)})),this.cameraPositionController=new v["b"](this.camera.position,.4,.05),window.addEventListener("mousemove",(function(e){N.onMouseMove(e)})),console.log(this.cameraTargetPosition),this.animate()}return Object(s["a"])(e,[{key:"render",value:function(){this.composer.render(),this.renderer.clearDepth(),this.refractionManager.render()}},{key:"onMouseMove",value:function(e){var t=this;this.mousePosX=e.clientX,this.mousePosY=e.clientY,this.pointer.x=e.clientX/window.innerWidth*2-1,this.pointer.y=-e.clientY/window.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);var n=this.raycaster.intersectObjects(this.intersectGlassObjs,!1);if(1!=n.length||this.glassIsRotating||this.glassSelected===n[0].object){if(0==n.length&&!this.glassIsRotating&&null!==this.glassSelected){console.log("out",this.glassSelected),this.glassIsRotating=!0;var r=this.glassSelected;g["c"](this.glassSelected.rotation,new l["n"](1,1,1),(function(e){r.rotation.copy(e)}),(function(){t.glassIsRotating=!1}),500),this.glassSelected=null}}else console.log("in"),this.glassIsRotating=!0,this.glassSelected=n[0].object,g["c"](this.glassSelected.rotation,new l["n"](1,6,1),(function(e){var n;null===(n=t.glassSelected)||void 0===n||n.rotation.copy(e)}),(function(){t.glassIsRotating=!1}),500),this.glassSelected.rotation.set(1,2,1)}},{key:"onClick",value:function(e){var t=this.raycaster.intersectObjects(this.intersectTardisCardObjs,!1);if(1==t.length){var n=t[0];this.cameraTargetPosition.x=n.object.position.x}}},{key:"getRaycastPos",value:function(e,t){var n=2*e/window.innerWidth-1,r=1-2*t/window.innerHeight,i=new l["X"](n,r,.995);return i.unproject(this.camera),i}},{key:"updatecornerObject",value:function(){var e=this.getRaycastPos(window.innerWidth/2,window.innerHeight/2);this.glassMesh1Controller.update(e)}},{key:"updateCamera",value:function(){var e=window.innerWidth/2-this.mousePosX,t=window.innerHeight/2-this.mousePosY,n=this.camera.position,r=new l["X"](-e/10,t/10,0).add(this.cameraTargetPosition),i=.7,o=new l["X"](n.x*i+r.x*(1-i),n.y*i+r.y*(1-i),n.z*i+r.z*(1-i));this.cameraPositionController.update(o);var a=this.cameraPositionController.velocity;this.camera.rotation.x=a.y/30,this.camera.rotation.y=-a.x/30}},{key:"updateCursorLight",value:function(){if(!isNaN(this.mousePosX)&&!isNaN(this.mousePosY)){var e=this.getRaycastPos(this.mousePosX,this.mousePosY),t=this.camera.position.z,n=(new l["X"]).copy(e);n=n.sub(this.camera.position);var r=-40,i=(r-t)/n.z;e.copy(this.camera.position),n.multiplyScalar(i),e.add(n),this.cursorLightController.update(e)}}}]),e}(),b=o["a"].extend({data:function(){return{fpm:null}},mounted:function(){this.$refs["canvas-container"]instanceof HTMLElement&&(this.fpm=new m(this.$refs["canvas-container"]))}}),y=b,x=(n("04de"),n("2877")),j=Object(x["a"])(y,r,i,!1,null,"10b339a2",null);t["default"]=j.exports},5303:function(e,t,n){var r={"./GlassFrontShader/V.glsl":"c444"};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id="5303"},7612:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("5a89");const i=new r["X"];function o(e,t,n,r,o,a){const s=2*Math.PI*o/4,c=Math.max(a-2*o,0),l=Math.PI/4;i.copy(t),i[r]=0,i.normalize();const h=.5*s/(s+c),d=1-i.angleTo(e)/l;if(1===Math.sign(i[n]))return d*h;{const e=c/(s+c);return e+h+h*(1-d)}}class a extends r["b"]{constructor(e=1,t=1,n=1,i=2,a=.1){if(i=2*i+1,a=Math.min(e/2,t/2,n/2,a),super(1,1,1,i,i,i),1===i)return;const s=this.toNonIndexed();this.index=null,this.attributes.position=s.attributes.position,this.attributes.normal=s.attributes.normal,this.attributes.uv=s.attributes.uv;const c=new r["X"],l=new r["X"],h=new r["X"](e,t,n).divideScalar(2).subScalar(a),d=this.attributes.position.array,u=this.attributes.normal.array,f=this.attributes.uv.array,v=d.length/6,p=new r["X"],w=.5/i;for(let r=0,g=0;r<d.length;r+=3,g+=2){c.fromArray(d,r),l.copy(c),l.x-=Math.sign(l.x)*w,l.y-=Math.sign(l.y)*w,l.z-=Math.sign(l.z)*w,l.normalize(),d[r+0]=h.x*Math.sign(c.x)+l.x*a,d[r+1]=h.y*Math.sign(c.y)+l.y*a,d[r+2]=h.z*Math.sign(c.z)+l.z*a,u[r+0]=l.x,u[r+1]=l.y,u[r+2]=l.z;const i=Math.floor(r/v);switch(i){case 0:p.set(1,0,0),f[g+0]=o(p,l,"z","y",a,n),f[g+1]=1-o(p,l,"y","z",a,t);break;case 1:p.set(-1,0,0),f[g+0]=1-o(p,l,"z","y",a,n),f[g+1]=1-o(p,l,"y","z",a,t);break;case 2:p.set(0,1,0),f[g+0]=1-o(p,l,"x","z",a,e),f[g+1]=o(p,l,"z","x",a,n);break;case 3:p.set(0,-1,0),f[g+0]=1-o(p,l,"x","z",a,e),f[g+1]=1-o(p,l,"z","x",a,n);break;case 4:p.set(0,0,1),f[g+0]=1-o(p,l,"x","y",a,e),f[g+1]=1-o(p,l,"y","x",a,t);break;case 5:p.set(0,0,-1),f[g+0]=o(p,l,"x","y",a,e),f[g+1]=1-o(p,l,"y","x",a,t);break}}}}},"7d52":function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return x}));var r=n("3835"),i=n("bee2"),o=n("d4ec"),a=n("ade3"),s=(n("d3b7"),n("159b"),n("38cf"),n("5a89")),c=n("4721"),l=n("7612");function h(e){try{var t=n("5303")("./"+e+"/V.glsl"),r=n("08fd")("./"+e+"/F.glsl");return[t,r]}catch(i){return console.error("failed to fetch shader",i),["",""]}}var d,u,f,v,p,w,g,m=n("61d9"),b=Object(i["a"])((function e(t,n,i,c,l,d,u){if(Object(o["a"])(this,e),Object(a["a"])(this,"mesh",void 0),Object(a["a"])(this,"originalMaterial",void 0),Object(a["a"])(this,"refractionMaterial",void 0),this.mesh=n,this.mesh.material instanceof Array){this.originalMaterial=new Array;for(var f=0;f<this.mesh.material.length;f++)this.originalMaterial.push(this.mesh.material[f].clone())}else this.originalMaterial=this.mesh.material.clone();var v={resolution:{type:"v",value:i},tBackground:{type:"t",value:c},tBackDepth:{type:"t",value:l},tSkybox:{type:"t",value:t.environment},refractionFactor:{type:"t",value:u},absorbColor:{type:"v",value:d}},p=h("GlassFrontShader"),w=Object(r["a"])(p,2),g=w[0],m=w[1];this.refractionMaterial=new s["O"]({vertexShader:g,fragmentShader:m,uniforms:v,side:s["r"]})})),y=function(){function e(t,n,r,i){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512;Object(o["a"])(this,e),Object(a["a"])(this,"container",void 0),Object(a["a"])(this,"backgroundScene",void 0),Object(a["a"])(this,"scene",void 0),Object(a["a"])(this,"renderer",void 0),Object(a["a"])(this,"camera",void 0),Object(a["a"])(this,"frontScene",void 0),Object(a["a"])(this,"backdepthTexture",void 0),Object(a["a"])(this,"backRenderTarget",void 0),Object(a["a"])(this,"refractionObjectList",void 0),Object(a["a"])(this,"suResolution",void 0),this.container=n,this.backgroundScene=t,this.scene=new s["N"],this.renderer=r,this.camera=i,this.frontScene=new s["N"],this.backdepthTexture=new s["j"](c,c,s["q"]),this.backRenderTarget=new s["Z"](this.container.offsetWidth*window.devicePixelRatio,this.container.offsetHeight*window.devicePixelRatio),this.backRenderTarget.depthBuffer=!0,this.backRenderTarget.depthTexture=this.backdepthTexture,this.backRenderTarget.depthTexture.type=s["V"],this.frontScene.background=this.backRenderTarget.texture,this.refractionObjectList=[],this.suResolution=new s["W"](this.container.offsetWidth*window.devicePixelRatio,this.container.offsetHeight*window.devicePixelRatio)}return Object(i["a"])(e,[{key:"addRefractionMesh",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s["f"](0),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.49;t&&(e.material=new s["B"]({color:new s["f"](0),transparent:!0,opacity:.3,metalness:.8,roughness:0,clearcoat:.2,side:s["a"]})),this.refractionObjectList.push(new b(this.backgroundScene,e,this.suResolution,this.backRenderTarget.texture,this.backRenderTarget.depthTexture,n,r)),this.scene.add(e)}},{key:"onWindowResize",value:function(){this.suResolution.x=this.container.offsetWidth*window.devicePixelRatio,this.suResolution.y=this.container.offsetHeight*window.devicePixelRatio}},{key:"render",value:function(){var e=this;this.refractionObjectList.forEach((function(t){t.mesh.material=t.originalMaterial,e.scene.add(t.mesh)})),this.renderer.setRenderTarget(this.backRenderTarget),this.renderer.render(this.scene,this.camera),this.refractionObjectList.forEach((function(t){t.mesh.material=t.refractionMaterial,e.frontScene.add(t.mesh)})),this.renderer.setRenderTarget(null),this.renderer.render(this.frontScene,this.camera)}}]),e}();function x(e){d=e,f=new s["E"](45,window.innerWidth/window.innerHeight,1,5e3),f.position.set(30,20,200),f.lookAt(0,0,0),w=new s["N"],u=new s["ab"]({antialias:!0,alpha:!0}),u.setClearColor(16777215),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),d.appendChild(u.domElement),v=new c["a"](f,d),d.style.position="absolute",d.style.top="0px",d.style.left="0px",p=new m["Stats"],p.domElement.style.zIndex="100",d.appendChild(p.domElement);var t="./cube/",n=[t+"px.jpg",t+"nx.jpg",t+"py.jpg",t+"ny.jpg",t+"pz.jpg",t+"nz.jpg"],r=(new s["h"]).load(n);r.mapping=s["g"],w.background=r,w.environment=r;var i=new s["k"];i.position.x=300,i.position.y=200,i.position.z=100,w.add(i);var o=(new s["S"]).load("./checkerboard.jpg");o.wrapS=o.wrapT=s["L"],o.repeat.set(10,10);var a=new s["z"]({map:o,side:s["l"]}),h=new s["G"](1e3,1e3,1,1),b=new s["y"](h,a);b.position.y-=20.1,b.rotation.x=Math.PI/2,g=new y(w,d,u,f);var x=new s["y"](new l["a"](40,40,40,5,5),new s["A"]({}));x.position.x-=40;var k=new s["y"](new s["P"](20),new s["A"]({})),C=new s["y"](new s["i"](20,20,80,36),new s["A"]({}));C.position.x+=40,C.position.y+=20,g.addRefractionMesh(x,!0,new s["f"](0),1.5),g.addRefractionMesh(k,!0,new s["f"](24576),1.5),g.addRefractionMesh(C,!0,new s["f"](1587),1.5);var O=new s["y"](new s["P"](20),new s["A"]({color:16711680}));O.position.copy(x.position),O.position.z-=50,w.add(O),window.addEventListener("resize",j),P()}function j(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),g.onWindowResize(),u.setSize(window.innerWidth,window.innerHeight)}function P(){requestAnimationFrame(P),k(),v.update(),p.update()}function k(){g.render()}},c444:function(e,t){e.exports="varying vec2 vUv;\r\nvarying vec3 vNormal;\r\nvarying vec3 vCameraPosition;\r\nvarying vec4 vWorldPosition;\r\nvarying mat4 vProjectionMatrix;\r\n// varying vec3 vRefract;\r\n// varying vec2 vRefractOffset;\r\n\r\n\r\nvoid main() {\r\n    vWorldPosition = modelMatrix * vec4( position, 1.0 );\r\n    vec4 mvPosition = viewMatrix * vWorldPosition;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n    vUv = uv;\r\n\r\n    vNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\r\n    vCameraPosition = cameraPosition;\r\n\r\n    vProjectionMatrix = projectionMatrix * modelViewMatrix;\r\n}\r\n"},f430:function(e,t){e.exports="uniform vec2 resolution;\r\nuniform sampler2D tBackground;\r\nuniform sampler2D tBackDepth;\r\nuniform samplerCube tSkybox;\r\nuniform vec3 absorbColor;\r\nuniform float refractionFactor;\r\n\r\nvarying vec2 vUv;\r\nvarying vec3 vNormal;\r\nvarying vec3 vCameraPosition;\r\nvarying vec4 vWorldPosition;\r\nvarying mat4 vProjectionMatrix;\r\n\r\nfloat near = 0.1;\r\nfloat far  = 5000.0;\r\n\r\nfloat LinearizeDepth(float depth) \r\n{\r\n    float z = depth * 2.0 - 1.0; // back to NDC \r\n    return (2.0 * near * far) / (far + near - z * (far - near));\t\r\n}\r\n\r\nvoid main() {\r\n\r\n    float backDepth = float(texture2D( tBackDepth, vec2( gl_FragCoord.x / resolution.x, gl_FragCoord.y / resolution.y ) ).x);\r\n    float frontDepth = gl_FragCoord.z;\r\n\r\n    float backDepthlinear = LinearizeDepth(backDepth);\r\n    float frontDepthlinear = LinearizeDepth(frontDepth);\r\n    \r\n    float backToFrontDepth = backDepthlinear - frontDepthlinear;\r\n    // backToFrontDepth *= 0.07;\r\n    \r\n    vec3 vCameraRay = vWorldPosition.xyz / vWorldPosition.w - vCameraPosition;\r\n    vCameraRay = normalize(vCameraRay);\r\n    vec3 vRefract = refract( vCameraRay, vNormal, 1.0 / refractionFactor );\r\n    vec4 vOriginalPos = vWorldPosition + vec4(vCameraRay, 0.0);\r\n    vec4 vRefractedPos = vWorldPosition + vec4(vRefract, 0.0);\r\n    // vRefractedPos = vOriginalPos; //vWorldPosition + vec4(vRefract, 0.0);\r\n    vec4 vOriginalProjectedPos = vProjectionMatrix * vOriginalPos;\r\n    vec4 vRefractedProjectedPos = vProjectionMatrix * vRefractedPos;\r\n    vec2 offset = normalize(vRefractedProjectedPos - vOriginalProjectedPos).xy;\r\n    offset = normalize(offset);\r\n\r\n    // reflect\r\n    vec3 vReflect = reflect( vCameraRay, vNormal );\r\n    vec3 refCol = vec3(textureCube(tSkybox, vReflect));\r\n\r\n    // snell's law\r\n    float cosTheta1 = dot(vCameraRay, vNormal);\r\n    float sinTheta1 = 1.0 - cosTheta1 * cosTheta1;\r\n    float sinTheta2 = sinTheta1 / refractionFactor;\r\n    float theta2 = asin(sinTheta2);\r\n    offset *= sinTheta2;\r\n    offset *= 50.0;\r\n\r\n    float samplePointX_r = (gl_FragCoord.x + backToFrontDepth * offset.x * 0.9) / resolution.x;\r\n    float samplePointY_r = (gl_FragCoord.y + backToFrontDepth * offset.y * 0.9) / resolution.y;\r\n\r\n    float samplePointX_g = (gl_FragCoord.x + backToFrontDepth * offset.x * 0.95) / resolution.x;\r\n    float samplePointY_g = (gl_FragCoord.y + backToFrontDepth * offset.y * 0.95) / resolution.y;\r\n\r\n    float samplePointX_b = (gl_FragCoord.x + backToFrontDepth * offset.x) / resolution.x;\r\n    float samplePointY_b = (gl_FragCoord.y + backToFrontDepth * offset.y) / resolution.y;\r\n    \r\n    float backColor_r = texture2D( tBackground, vec2( samplePointX_r, samplePointY_r ) * 1.0 ).x;\r\n    float backColor_g = texture2D( tBackground, vec2( samplePointX_g, samplePointY_g ) * 1.0 ).y;\r\n    float backColor_b = texture2D( tBackground, vec2( samplePointX_b, samplePointY_b ) * 1.0 ).z;\r\n\r\n    vec3 backColor = vec3(backColor_r, backColor_g, backColor_b);\r\n    vec3 absorbColor = absorbColor * backToFrontDepth * 0.2;\r\n\r\n    // backColor = texture2D( tBackground, vec2( (gl_FragCoord.x + backToFrontDepth * offset.x) / resolution.x, (gl_FragCoord.y + backToFrontDepth * offset.y) / resolution.y ) * 1.0 ).xyz;\r\n\r\n    // gl_FragColor = vec4(refCol, 1.0);\r\n    float reflectionCoeff = 0.5 * pow(sinTheta1, 4.0);\r\n    // reflectionCoeff = 1.0;\r\n    gl_FragColor = vec4((1.0 - reflectionCoeff) * (backColor + absorbColor) + reflectionCoeff * refCol, 1.0);\r\n    // gl_FragColor = vec4(vec3(backDepthlinear*0.01), 1.0);\r\n}"}}]);
//# sourceMappingURL=chunk-19a8ab1c.715f4dcc.js.map