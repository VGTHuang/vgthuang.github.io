(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-86717ca2"],{"04d1":function(e,t,r){var n=r("342f"),i=n.match(/firefox\/(\d+)/i);e.exports=!!i&&+i[1]},"08fd":function(e,t,r){var n={"./GlassFrontShader/F.glsl":"f430"};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id="08fd"},1148:function(e,t,r){"use strict";var n=r("da84"),i=r("5926"),a=r("577e"),o=r("1d80"),s=n.RangeError;e.exports=function(e){var t=a(o(this)),r="",n=i(e);if(n<0||n==1/0)throw s("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r}},"32a7":function(e,t,r){"use strict";r("4acd")},"38cf":function(e,t,r){var n=r("23e7"),i=r("1148");n({target:"String",proto:!0},{repeat:i})},"44ec":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{ref:"canvas-container",attrs:{id:"canvas-container"}},[r("div",{staticClass:"loading-container",class:{"loading-container--hidden":e.loadingStat.isLoaded,"loading-container--none":e.loadingStat.noLoadingStat}},[r("div",{staticClass:"load-stat"},[r("div",{staticClass:"load-pgbar",style:{width:100*e.loadingStat.loaded/e.loadingStat.total+"%"}}),r("div",{staticClass:"load-text"},[e._v(e._s(Math.round(100*e.loadingStat.loaded/e.loadingStat.total))+" %")])])])]),r("div",{ref:"dom3d-container",attrs:{id:"dom3d-container"}},[r("div",{ref:"dom3d-test",attrs:{id:"dom3d-test"}},[r("p",[e._v("HTML element: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua")])]),r("div",{ref:"dom3d-glass",attrs:{id:"dom3d-glass"},on:{click:e.onGlassClick}},[e._m(0)])])])},i=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"dom3d-glass-ball"},[r("div",{staticClass:"dom3d-glass-ball__text"},[e._v("html element following object")])])}],a=r("5a89"),o=r("2b0e"),s=r("d4ec"),c=r("bee2"),l=r("ade3"),d=(r("d3b7"),r("159b"),r("38cf"),r("4c53"),r("32d9")),h=r("93e9"),u=r("257e"),f=r("262e"),g=r("2caf");class v extends a["T"]{constructor(e,t={}){super(e),this.type="Reflector";const r=this,n=void 0!==t.color?new a["m"](t.color):new a["m"](8355711),i=t.textureWidth||512,o=t.textureHeight||512,s=t.clipBias||0,c=t.shader||v.ReflectorShader,l=new a["db"],d=new a["Fb"],h=new a["Fb"],u=new a["Fb"],f=new a["S"],g=new a["Fb"](0,0,-1),p=new a["Gb"],m=new a["Fb"],b=new a["Fb"],w=new a["Gb"],y=new a["S"],x=new a["cb"],M=new a["Jb"](i,o),C=new a["qb"]({uniforms:a["Cb"].clone(c.uniforms),fragmentShader:c.fragmentShader,vertexShader:c.vertexShader});C.uniforms["tDiffuse"].value=M.texture,C.uniforms["color"].value=n,C.uniforms["textureMatrix"].value=y,this.material=C,this.onBeforeRender=function(e,t,n){if(h.setFromMatrixPosition(r.matrixWorld),u.setFromMatrixPosition(n.matrixWorld),f.extractRotation(r.matrixWorld),d.set(0,0,1),d.applyMatrix4(f),m.subVectors(h,u),m.dot(d)>0)return;m.reflect(d).negate(),m.add(h),f.extractRotation(n.matrixWorld),g.set(0,0,-1),g.applyMatrix4(f),g.add(u),b.subVectors(h,g),b.reflect(d).negate(),b.add(h),x.position.copy(m),x.up.set(0,1,0),x.up.applyMatrix4(f),x.up.reflect(d),x.lookAt(b),x.far=n.far,x.updateMatrixWorld(),x.projectionMatrix.copy(n.projectionMatrix),y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(x.projectionMatrix),y.multiply(x.matrixWorldInverse),y.multiply(r.matrixWorld),l.setFromNormalAndCoplanarPoint(d,h),l.applyMatrix4(x.matrixWorldInverse),p.set(l.normal.x,l.normal.y,l.normal.z,l.constant);const i=x.projectionMatrix;w.x=(Math.sign(p.x)+i.elements[8])/i.elements[0],w.y=(Math.sign(p.y)+i.elements[9])/i.elements[5],w.z=-1,w.w=(1+i.elements[10])/i.elements[14],p.multiplyScalar(2/p.dot(w)),i.elements[2]=p.x,i.elements[6]=p.y,i.elements[10]=p.z+1-s,i.elements[14]=p.w,M.texture.encoding=e.outputEncoding,r.visible=!1;const a=e.getRenderTarget(),o=e.xr.enabled,c=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(M),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,x),e.xr.enabled=o,e.shadowMap.autoUpdate=c,e.setRenderTarget(a);const v=n.viewport;void 0!==v&&e.state.viewport(v),r.visible=!0},this.getRenderTarget=function(){return M},this.dispose=function(){M.dispose(),r.material.dispose()}}}v.prototype.isReflector=!0,v.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t}"};var p=function(e){Object(f["a"])(r,e);var t=Object(g["a"])(r);function r(e,n){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s["a"])(this,r),i=t.call(this,e),Object(l["a"])(Object(u["a"])(i),"material",void 0);var c=Object(u["a"])(i),d=(void 0!==o.color?new a["m"](o.color):new a["m"](16777215),o.textureWidth||512),h=o.textureHeight||512,f=o.clipBias||0,g=o.flowDirection||new a["Eb"](1,0),p=o.flowSpeed||.01,b=o.reflectivity||.5,w=o.scale||1,y=m,x=new a["zb"],M=o.normalMap0||x.load("./water/Water_1_M_Normal.jpg"),C=o.normalMap1||x.load("./water/Water_2_M_Normal.jpg"),j=.15,O=.5*j,k=new a["S"],P=new a["l"];i.material=new a["qb"];var T=new v(e,{textureWidth:d,textureHeight:h,clipBias:f});function S(e){k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),k.multiply(e.projectionMatrix),k.multiply(e.matrixWorldInverse),k.multiply(c.matrixWorld)}function R(){var e=P.getDelta(),t=c.material.uniforms["config"];t.value.x+=p*e,t.value.y=t.value.x+O,t.value.x>=j?(t.value.x=0,t.value.y=O):t.value.y>=j&&(t.value.y=t.value.y-j)}return T.matrixAutoUpdate=!1,i.material=new a["qb"]({uniforms:a["Cb"].merge([a["Bb"]["fog"],y.uniforms]),vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,transparent:!0,fog:!0}),i.material.uniforms["flowDirection"].value=g,M.wrapS=M.wrapT=a["mb"],C.wrapS=C.wrapT=a["mb"],i.material.uniforms["tReflectionMap"].value=T.getRenderTarget().texture,i.material.uniforms["tNormalMap0"].value=M,i.material.uniforms["tNormalMap1"].value=C,i.material.uniforms["reflectivity"].value=b,i.material.uniforms["textureMatrix"].value=k,i.material.uniforms["config"].value.x=0,i.material.uniforms["config"].value.y=O,i.material.uniforms["config"].value.z=O,i.material.uniforms["config"].value.w=w,i.onBeforeRender=function(e,t,r,i,a,o){S(r),R(),c.visible=!1,T.matrixWorld.copy(c.matrixWorld),T.onBeforeRender(e,n,r,i,a,o),c.visible=!0},i}return Object(c["a"])(r)}(a["T"]),m={uniforms:{reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new a["Gb"]},flowDirection:{type:"v2",value:new a["Eb"]}},vertexShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tuniform mat4 textureMatrix;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tvCoord = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\t\t\tvToEye = cameraPosition - worldPosition.xyz;\n\n\t\t\tvec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex\n\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\n\t\tuniform vec2 flowDirection;\n\n\t\tuniform float reflectivity;\n\t\tuniform vec4 config;\n\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec3 vToEye;\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tfloat flowMapOffset0 = config.x;\n\t\t\tfloat flowMapOffset1 = config.y;\n\t\t\tfloat halfCycle = config.z;\n\t\t\tfloat scale = config.w;\n\n\t\t\tvec3 toEye = normalize( vToEye );\n\n\t\t\t// determine flow direction\n\t\t\tvec2 flow;\n\t\t\tflow = flowDirection;\n\t\t\tflow.x *= - 1.0;\n\n\t\t\t// sample normal maps (distort uvs with flowdata)\n\t\t\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n\t\t\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n\n\t\t\t// linear interpolate to get the final normal color\n\t\t\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\n\t\t\t// calculate normal vector\n\t\t\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\n\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\tfloat theta = max( dot( toEye, normal ), 0.0 );\n\t\t\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );\n            reflectance = pow(reflectance + 0.3, 4.0);\n            // reflectance = floor(reflectance *  2.0) / 4.0;\n            vec4 refractColor = vec4(1.0);\n\n\t\t\t// calculate final uv coords\n\t\t\tvec3 coord = vCoord.xyz / vCoord.w;\n\t\t\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;\n\n\t\t\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n            reflectColor *= vec4(1.0, 1.0, 0.8, 1.0);\n\n\t\t\tgl_FragColor = mix(refractColor, reflectColor, reflectance);\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}"},b=r("61d9"),w=r("232b");function y(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(l){return void r(l)}s.done?t(c):Promise.resolve(c).then(n,i)}function x(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){y(a,n,i,o,s,"next",e)}function s(e){y(a,n,i,o,s,"throw",e)}o(void 0)}))}}var M=r("3835"),C=(r("96cf"),r("a434"),r("d81d"),r("4e82"),r("b64b"),r("f998")),j=r("4e0a"),O=function(){function e(t,r,n){Object(s["a"])(this,e),Object(l["a"])(this,"index",void 0),Object(l["a"])(this,"mesh",void 0),Object(l["a"])(this,"uniforms",void 0),Object(l["a"])(this,"textureList",void 0),Object(l["a"])(this,"isPushingTexture",void 0),this.index=t,this.mesh=r,this.uniforms=n,this.mesh=r,this.textureList=[],this.isPushingTexture=!1}return Object(c["a"])(e,[{key:"pushNewTexture",value:function(e){0==this.textureList.length?this.textureList.push(void 0,e):(1==this.textureList.length||this.textureList.splice(1,this.textureList.length-2),this.textureList.push(e)),0==this.isPushingTexture&&this.recPushTexture()}},{key:"recPushTexture",value:function(){var e=this;this.textureList.length<=1?this.isPushingTexture=!1:(this.isPushingTexture=!0,2==this.textureList.length&&(this.uniforms.vTextureMix.value=0,this.uniforms.vTextures.value[0]=this.textureList[0],this.uniforms.vTextures.value[1]=this.textureList[1],this.isPushingTexture=!1,C["a"].tweenNumber(0,1,(function(t){e.uniforms.vTextureMix.value=t}),(function(){e.uniforms.vTextures.value[0]=e.textureList[1],e.uniforms.vTextures.value[1]=e.textureList[1],e.uniforms.vTextureMix.value=1,e.textureList.splice(0,1),e.recPushTexture()}),500)))}}]),e}(),k=function(e){Object(f["a"])(r,e);var t=Object(g["a"])(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{numOfVisiblePics:3};Object(s["a"])(this,r),e=t.call(this),Object(l["a"])(Object(u["a"])(e),"numOfVisiblePics",void 0),Object(l["a"])(Object(u["a"])(e),"rotateNode",void 0),Object(l["a"])(Object(u["a"])(e),"isRotating",void 0),Object(l["a"])(Object(u["a"])(e),"planes",void 0),Object(l["a"])(Object(u["a"])(e),"planeWidth",void 0),Object(l["a"])(Object(u["a"])(e),"planeHeight",void 0),Object(l["a"])(Object(u["a"])(e),"planeGap",void 0),Object(l["a"])(Object(u["a"])(e),"preloadImgs",void 0),Object(l["a"])(Object(u["a"])(e),"maxPreloadImgCount",void 0),Object(l["a"])(Object(u["a"])(e),"carouselArrayRadius",void 0),Object(l["a"])(Object(u["a"])(e),"carouselArrayAngle",void 0),Object(l["a"])(Object(u["a"])(e),"currentCenter",void 0),e.isRotating=!1,e.rotateNode=new a["D"],e.add(e.rotateNode),e.currentCenter=0,e.numOfVisiblePics=n.numOfVisiblePics,e.planes=[],e.planeWidth=n.planeWidth||50,e.planeHeight=n.planeHeight||50,e.planeGap=n.planeGap||10,e.preloadImgs={},e.maxPreloadImgCount=2*e.numOfVisiblePics,e.carouselArrayRadius=n.carouselArrayRadius||100,e.carouselArrayAngle=2*Math.atan((e.planeWidth+e.planeGap)/(2*e.carouselArrayRadius));for(var i=Object(j["a"])("CarouselBasicShader"),o=Object(M["a"])(i,2),c=o[0],d=o[1],h=0;h<e.numOfVisiblePics;h++){var f={vColor:{type:"c",value:new a["m"](16711680)},vTextures:{type:"tv",value:[void 0,void 0]},vTextureMix:{type:"f",value:1}},g=new a["T"](new a["eb"](e.planeWidth,e.planeHeight,1,1),new a["qb"]({uniforms:f,vertexShader:c,fragmentShader:d})),v=h-(e.numOfVisiblePics-1)/2;g.rotation.y=-v*e.carouselArrayAngle,g.position.x=e.carouselArrayRadius*Math.sin(v*e.carouselArrayAngle),g.position.z=-e.carouselArrayRadius*Math.cos(v*e.carouselArrayAngle),e.planes.push(new O(h,g,f)),e.rotateNode.add(g)}return e.planes.forEach((function(t){e.__imgSrcToTex("https://picsum.photos/id/".concat(Math.ceil(50*Math.random()),"/200/200")).then((function(e){t.pushNewTexture(e)}))})),e}return Object(c["a"])(r,[{key:"clickToChangeTex",value:function(e,t){var r=this,n=this.planes.map((function(e){return e.mesh})),i=e.intersectObjects(n);if(1==i.length){var o=i[0].object;if(o instanceof a["T"]){var s=n.indexOf(o),c=t(s);this.__imgSrcToTex(c).then((function(e){r.planes[s].pushNewTexture(e)}))}}}},{key:"clickToRotate",value:function(e,t){var r=this.planes.map((function(e){return e.mesh})),n=e.intersectObjects(r);if(1==n.length){var i=n[0].object;if(i instanceof a["T"]){var o=r.indexOf(i),s=this.planes[o].index-this.currentCenter-Math.floor(this.planes.length/2);s<0?this.moveLeft(-s,t):s>0&&this.moveRight(s,t)}}}},{key:"moveLeft",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1?arguments[1]:void 0;if(!this.isRotating){this.isRotating=!0;for(var n=function(t){e.planes.sort((function(e,t){return t.index-e.index}));var n=e.planes[0];n.index=e.planes[e.planes.length-1].index-1;var i=n.index-(e.numOfVisiblePics-1)/2;n.mesh.rotation.y=-i*e.carouselArrayAngle,n.mesh.position.x=e.carouselArrayRadius*Math.sin(i*e.carouselArrayAngle),n.mesh.position.z=-e.carouselArrayRadius*Math.cos(i*e.carouselArrayAngle);var a=r(n.index);e.__imgSrcToTex(a).then((function(e){n.pushNewTexture(e)}))},i=0;i<t;i++)n(i);C["a"].tweenNumber(0,t,(function(t){var r=e.carouselArrayAngle*(e.currentCenter-t);e.rotateNode.rotation.y=r}),(function(){e.currentCenter-=t,e.isRotating=!1}),500)}}},{key:"moveRight",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1?arguments[1]:void 0;if(!this.isRotating){this.isRotating=!0;for(var n=function(t){e.planes.sort((function(e,t){return e.index-t.index}));var n=e.planes[0];n.index=e.planes[e.planes.length-1].index+1;var i=n.index-(e.numOfVisiblePics-1)/2;n.mesh.rotation.y=-i*e.carouselArrayAngle,n.mesh.position.x=e.carouselArrayRadius*Math.sin(i*e.carouselArrayAngle),n.mesh.position.z=-e.carouselArrayRadius*Math.cos(i*e.carouselArrayAngle);var a=r(n.index);e.__imgSrcToTex(a).then((function(e){n.pushNewTexture(e)}))},i=0;i<t;i++)n(i);C["a"].tweenNumber(0,t,(function(t){var r=e.carouselArrayAngle*(e.currentCenter+t);e.rotateNode.rotation.y=r}),(function(){e.currentCenter+=t,e.isRotating=!1}),500)}}},{key:"__imgSrcToTex",value:function(){var e=x(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this,e.abrupt("return",new Promise((function(e,n){r.preloadImgs[t]&&e(r.preloadImgs[t]);var i=new a["F"];i.setCrossOrigin("anonymous"),i.load(t,(function(n){var i=new a["yb"](n);if(i.needsUpdate=!0,r.preloadImgs[t]=i,Object.keys(r.preloadImgs).length>=r.maxPreloadImgCount)for(var o in r.preloadImgs){for(var s=r.preloadImgs[o],c=!0,l=0;l<r.planes.length;l++)if(r.planes[l].uniforms.vTextures.value.indexOf(s)>-1){c=!1;break}if(c){s.dispose(),delete r.preloadImgs[o];break}}e(i)}))})));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),r}(a["D"]);class P extends a["L"]{constructor(e){super(e),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(e,t,r,n){const i=this,o=""===this.path?a["M"].extractUrlBase(e):this.path,s=new a["z"](this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{t(i.parse(r,o))}catch(a){n?n(a):console.error(a),i.manager.itemError(e)}}),r,n)}parse(e,t){this.group=new a["D"],this.materials=[],this.meshes=[],this.readFile(e,t);for(let r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group}readFile(e,t){const r=new DataView(e),n=new T(r,0,this.debugMessage);if(n.id===R||n.id===F||n.id===S){let e=n.readChunk();while(e){if(e.id===_){const t=e.readDWord();this.debugMessage("3DS file version: "+t)}else e.id===A?this.readMeshData(e,t):this.debugMessage("Unknown main chunk: "+e.hexId);e=n.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,t){let r=e.readChunk();while(r){if(r.id===N){const e=+r.readDWord();this.debugMessage("Mesh Version: "+e)}else if(r.id===U){const e=r.readFloat();this.debugMessage("Master scale: "+e),this.group.scale.set(e,e,e)}else r.id===ce?(this.debugMessage("Named Object"),this.readNamedObject(r)):r.id===G?(this.debugMessage("Material"),this.readMaterialEntry(r,t)):this.debugMessage("Unknown MDATA chunk: "+r.hexId);r=e.readChunk()}}readNamedObject(e){const t=e.readString();let r=e.readChunk();while(r){if(r.id===le){const e=this.readMesh(r);e.name=t,this.meshes.push(e)}else this.debugMessage("Unknown named object chunk: "+r.hexId);r=e.readChunk()}}readMaterialEntry(e,t){let r=e.readChunk();const n=new a["W"];while(r){if(r.id===H)n.name=r.readString(),this.debugMessage("   Name: "+n.name);else if(r.id===K)this.debugMessage("   Wireframe"),n.wireframe=!0;else if(r.id===Z){const e=r.readByte();n.wireframeLinewidth=e,this.debugMessage("   Wireframe Thickness: "+e)}else if(r.id===$)n.side=a["t"],this.debugMessage("   DoubleSided");else if(r.id===J)this.debugMessage("   Additive Blending"),n.blending=a["b"];else if(r.id===V)this.debugMessage("   Diffuse Color"),n.color=this.readColor(r);else if(r.id===X)this.debugMessage("   Specular Color"),n.specular=this.readColor(r);else if(r.id===B)this.debugMessage("   Ambient color"),n.color=this.readColor(r);else if(r.id===q){const e=this.readPercentage(r);n.shininess=100*e,this.debugMessage("   Shininess : "+e)}else if(r.id===Y){const e=this.readPercentage(r);n.opacity=1-e,this.debugMessage("  Transparency : "+e),n.transparent=n.opacity<1}else r.id===Q?(this.debugMessage("   ColorMap"),n.map=this.readMap(r,t)):r.id===te?(this.debugMessage("   BumpMap"),n.bumpMap=this.readMap(r,t)):r.id===ee?(this.debugMessage("   OpacityMap"),n.alphaMap=this.readMap(r,t)):r.id===re?(this.debugMessage("   SpecularMap"),n.specularMap=this.readMap(r,t)):this.debugMessage("   Unknown material chunk: "+r.hexId);r=e.readChunk()}this.materials[n.name]=n}readMesh(e){let t=e.readChunk();const r=new a["h"],n=new a["W"],i=new a["T"](r,n);i.name="mesh";while(t){if(t.id===de){const e=t.readWord();this.debugMessage("   Vertex: "+e);const n=[];for(let r=0;r<e;r++)n.push(t.readFloat()),n.push(t.readFloat()),n.push(t.readFloat());r.setAttribute("position",new a["A"](n,3))}else if(t.id===he)this.readFaceArray(t,i);else if(t.id===fe){const e=t.readWord();this.debugMessage("   UV: "+e);const n=[];for(let r=0;r<e;r++)n.push(t.readFloat()),n.push(t.readFloat());r.setAttribute("uv",new a["A"](n,2))}else if(t.id===ge){this.debugMessage("   Tranformation Matrix (TODO)");const e=[];for(let r=0;r<12;r++)e[r]=t.readFloat();const n=new a["S"];n.elements[0]=e[0],n.elements[1]=e[6],n.elements[2]=e[3],n.elements[3]=e[9],n.elements[4]=e[2],n.elements[5]=e[8],n.elements[6]=e[5],n.elements[7]=e[11],n.elements[8]=e[1],n.elements[9]=e[7],n.elements[10]=e[4],n.elements[11]=e[10],n.elements[12]=0,n.elements[13]=0,n.elements[14]=0,n.elements[15]=1,n.transpose();const o=new a["S"];o.copy(n).invert(),r.applyMatrix4(o),n.decompose(i.position,i.quaternion,i.scale)}else this.debugMessage("   Unknown mesh chunk: "+t.hexId);t=e.readChunk()}return r.computeVertexNormals(),i}readFaceArray(e,t){const r=e.readWord();this.debugMessage("   Faces: "+r);const n=[];for(let o=0;o<r;++o)n.push(e.readWord(),e.readWord(),e.readWord()),e.readWord();t.geometry.setIndex(n);let i=0,a=0;while(!e.endOfChunk){const r=e.readChunk();if(r.id===ue){this.debugMessage("      Material Group");const e=this.readMaterialGroup(r),n=3*e.index.length;t.geometry.addGroup(a,n,i),a+=n,i++;const o=this.materials[e.name];!1===Array.isArray(t.material)&&(t.material=[]),void 0!==o&&t.material.push(o)}else this.debugMessage("      Unknown face array chunk: "+r.hexId)}1===t.material.length&&(t.material=t.material[0])}readMap(e,t){let r=e.readChunk(),n={};const i=new a["zb"](this.manager);i.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);while(r){if(r.id===ne){const e=r.readString();n=i.load(e),this.debugMessage("      File: "+t+e)}else r.id===oe?(n.offset.x=r.readFloat(),this.debugMessage("      OffsetX: "+n.offset.x)):r.id===se?(n.offset.y=r.readFloat(),this.debugMessage("      OffsetY: "+n.offset.y)):r.id===ie?(n.repeat.x=r.readFloat(),this.debugMessage("      RepeatX: "+n.repeat.x)):r.id===ae?(n.repeat.y=r.readFloat(),this.debugMessage("      RepeatY: "+n.repeat.y)):this.debugMessage("      Unknown map chunk: "+r.hexId);r=e.readChunk()}return n}readMaterialGroup(e){const t=e.readString(),r=e.readWord();this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);const n=[];for(let i=0;i<r;++i)n.push(e.readWord());return{name:t,index:n}}readColor(e){const t=e.readChunk(),r=new a["m"];if(t.id===z||t.id===D){const e=t.readByte(),n=t.readByte(),i=t.readByte();r.setRGB(e/255,n/255,i/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===L||t.id===W){const e=t.readFloat(),n=t.readFloat(),i=t.readFloat();r.setRGB(e,n,i),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.hexId);return r}readPercentage(e){const t=e.readChunk();switch(t.id){case E:return t.readShort()/100;case I:return t.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+t.hexId),0}}debugMessage(e){this.debug&&console.log(e)}}class T{constructor(e,t,r){this.data=e,this.offset=t,this.position=t,this.debugMessage=r,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>e.byteLength&&this.debugMessage("Bad chunk size for chunk at "+t)}readChunk(){if(this.endOfChunk)return null;try{const e=new T(this.data,this.position,this.debugMessage);return this.position+=e.size,e}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const e=this.data.getUint8(this.position,!0);return this.position+=1,e}readFloat(){try{const e=this.data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){return this.debugMessage(e+" "+this.position+" "+this.data.byteLength),0}}readInt(){const e=this.data.getInt32(this.position,!0);return this.position+=4,e}readShort(){const e=this.data.getInt16(this.position,!0);return this.position+=2,e}readDWord(){const e=this.data.getUint32(this.position,!0);return this.position+=4,e}readWord(){const e=this.data.getUint16(this.position,!0);return this.position+=2,e}readString(){let e="",t=this.readByte();while(t)e+=String.fromCharCode(t),t=this.readByte();return e}}const S=19789,R=15786,F=49725,_=2,L=16,z=17,D=18,W=19,E=48,I=49,A=15677,N=15678,U=256,G=45055,H=40960,B=40976,V=40992,X=41008,q=41024,Y=41040,$=41089,J=41091,K=41093,Z=41095,Q=41472,ee=41488,te=41520,re=41476,ne=41728,ie=41812,ae=41814,oe=41816,se=41818,ce=16384,le=16640,de=16656,he=16672,ue=16688,fe=16704,ge=16736;var ve=r("fb12"),pe=r("26e3"),me=r("7d52"),be=r("7612"),we=function(){function e(t,r,n,i){var o=this;Object(s["a"])(this,e),Object(l["a"])(this,"container",void 0),Object(l["a"])(this,"renderer",void 0),Object(l["a"])(this,"cardInsideScene",void 0),Object(l["a"])(this,"scene",void 0),Object(l["a"])(this,"reflectionScene",void 0),Object(l["a"])(this,"composer",void 0),Object(l["a"])(this,"stats",void 0),Object(l["a"])(this,"refractionManager",void 0),Object(l["a"])(this,"glassMesh1Controller",void 0),Object(l["a"])(this,"mousePosX",void 0),Object(l["a"])(this,"mousePosY",void 0),Object(l["a"])(this,"pointer",void 0),Object(l["a"])(this,"camera",void 0),Object(l["a"])(this,"cameraZPosition",void 0),Object(l["a"])(this,"cameraPositionController",void 0),Object(l["a"])(this,"cameraTargetPosition",void 0),Object(l["a"])(this,"cameraWithMouseMoveFactor",void 0),Object(l["a"])(this,"cameraWithMouseRotateFactor",void 0),Object(l["a"])(this,"cursorLightGroup",void 0),Object(l["a"])(this,"cursorLight",void 0),Object(l["a"])(this,"cursorLightController",void 0),Object(l["a"])(this,"raycaster",void 0),Object(l["a"])(this,"intersectTardisCardObjs",void 0),Object(l["a"])(this,"intersectGlassObjs",void 0),Object(l["a"])(this,"glassSelected",void 0),Object(l["a"])(this,"glassIsRotating",void 0),Object(l["a"])(this,"cssScene",void 0),Object(l["a"])(this,"cssRenderer",void 0),Object(l["a"])(this,"cssAttachObject",void 0),Object(l["a"])(this,"carousel1",void 0),Object(l["a"])(this,"carousel2",void 0),Object(l["a"])(this,"loadingManager",void 0),Object(l["a"])(this,"animate",(function(){requestAnimationFrame(o.animate),o.updatecornerObject(),o.updateCamera(),o.updateCursorLight(),o.render(),o.stats.update()})),this.cameraZPosition=500,this.container=t,this.camera=new a["cb"](45,window.innerWidth/window.innerHeight,1,5e3),this.renderer=new a["Kb"]({alpha:!0}),this.renderer.setClearColor(16777215),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.container.appendChild(this.renderer.domElement),this.stats=new b["Stats"],this.stats.domElement.style.zIndex="100",this.container.appendChild(this.stats.domElement),this.scene=new a["ob"],this.cssScene=new a["ob"],this.cardInsideScene=new a["ob"],this.reflectionScene=new a["ob"],this.loadingManager=new a["N"]((function(){r&&r()}),(function(e,t,r){n&&n(e,t,r)}),(function(e){i&&i(e)}));var c="./cube1/",u=[c+"px.jpg",c+"nx.jpg",c+"py.jpg",c+"ny.jpg",c+"pz.jpg",c+"nz.jpg"],f=new a["o"](this.loadingManager).load(u);f.mapping=a["n"],this.scene.environment=f;var g=new a["s"];g.intensity=.8,g.position.x=80,g.position.y=80,g.position.z=100,this.scene.add(g),this.refractionManager=new me["a"](this.scene,this.container,this.renderer,this.camera);var v=new a["T"](new be["a"](40,40,40,5,5),new a["W"]({})),m=new a["T"](new a["g"](40,40,40),new a["U"]({}));m.visible=!1,v.add(m),v.rotation.set(1,1,1),this.refractionManager.addRefractionMesh(v,!0,null,65280,4219135,1.3,.8),this.glassMesh1Controller=new pe["a"](v,.2,.1);var y=new h["a"](this.scene,this.camera);y.clear=!0;var x=new h["a"](this.cardInsideScene,this.camera);x.clearDepth=!0,x.clear=!1,this.composer=new d["a"](this.renderer,new a["Ib"](this.container.offsetWidth*window.devicePixelRatio,this.container.offsetHeight*window.devicePixelRatio)),this.composer.addPass(y),this.composer.addPass(x),this.composer.renderTarget1.stencilBuffer=!0,this.composer.renderTarget2.stencilBuffer=!0;var M=new w["a"](100,400,110,this.scene,this.cardInsideScene,new a["Fb"](0,200,0),new a["x"],w["b"].RECT,null);M.addSkybox(f);var C=new a["D"],j=new a["zb"](this.loadingManager).load("./title.png"),O=new a["T"](new a["eb"](390,90,1,1),new a["U"]({color:16777215,alphaMap:j,alphaToCoverage:!0,transparent:!0}));C.add(O),C.position.copy(M.cardMesh.position),M.addVisibleObjectGroup(C),this.cssAttachObject=M.cardMesh;var T=new w["a"](200,200,111,this.scene,this.cardInsideScene,new a["Fb"](0,0,0),new a["x"],w["b"].RECT,this.reflectionScene,12636368),S=new a["zb"](this.loadingManager).load("./marble/diffuse.jpg"),R=new a["zb"](this.loadingManager).load("./marble/normal.jpg"),F=new a["zb"](this.loadingManager).load("./marble/specular.jpg"),_=[S,R,F];_.forEach((function(e){e.wrapS=e.wrapT=a["mb"],e.repeat.set(1,2)}));var L=new a["D"],z=new a["zb"](this.loadingManager).load("./jutabag3ds/texture/normal.jpg"),D=new P(this.loadingManager);D.setResourcePath("./jutabag3ds/texture/"),D.load("./jutabag3ds/portalgun.3ds",(function(e){if(e instanceof a["D"]){e.traverse((function(e){e instanceof a["T"]&&(console.log(e.material),e.material.color=new a["m"](16777215),e.material.normalMap=z)})),e.scale.multiplyScalar(80),e.position.x-=20,e.position.y+=10,e.position.z-=80,e.rotation.x=-2,e.rotation.z=.7,L.add(e);var t=new a["T"](new a["eb"](500,500,1,1),new a["X"]({color:13434879,map:S,normalMap:R,normalScale:new a["Eb"](.1,.1),specularColorMap:F,specularIntensity:4,reflectivity:1,metalness:.2,roughness:.1,clearcoat:.5}));t.position.set(0,0,-150),L.add(t),L.position.copy(T.cardMesh.position),T.addVisibleObjectGroup(L)}}));var W=new w["a"](100,100,112,this.scene,this.cardInsideScene,new a["Fb"](200,0,0),new a["x"],w["b"].CIRCLE,this.reflectionScene,13680848);this.carousel1=new k({numOfVisiblePics:5,planeWidth:80,planeHeight:80,carouselArrayRadius:120});var E=new a["zb"](this.loadingManager).load("./painting/crop1_diffuse.png"),I=new a["zb"](this.loadingManager).load("./painting/crop1_normal.png"),A=new a["zb"](this.loadingManager).load("./painting/crop1_specular.png");_=[E,I,A];var N=new a["T"](new a["eb"](500,500,1,1),new a["X"]({map:E,normalMap:I,specularColorMap:A,normalScale:new a["Eb"](.4,.4),specularIntensity:.2,reflectivity:.1,metalness:.1,roughness:.4}));N.position.set(0,0,-150);var U=new a["D"];U.add(this.carousel1),U.add(N),U.position.copy(W.cardMesh.position),W.addVisibleObjectGroup(U);var G=new w["a"](100,100,113,this.scene,this.cardInsideScene,new a["Fb"](-200,0,0),new a["x"],w["b"].CIRCLE,this.reflectionScene,10535056);this.carousel2=new k({numOfVisiblePics:4,planeWidth:70,planeHeight:70,carouselArrayRadius:120});var H=new a["zb"](this.loadingManager).load("./painting/crop2_diffuse.png"),B=new a["zb"](this.loadingManager).load("./painting/crop2_normal.png"),V=new a["zb"](this.loadingManager).load("./painting/crop2_specular.png");_=[H,B],N=new a["T"](new a["eb"](500,500,1,1),new a["X"]({color:16777088,map:H,normalMap:B,specularColorMap:V,normalScale:new a["Eb"](.5,.5),specularIntensity:.2,reflectivity:.8,metalness:0,roughness:.2})),N.position.set(0,0,-150);var X=new a["D"];X.add(this.carousel2),X.add(N),X.position.copy(G.cardMesh.position),G.addVisibleObjectGroup(X);var q=new a["fb"](1e3,400),Y=new p(q,this.reflectionScene,{flowDirection:new a["Eb"](1,1),textureWidth:512,textureHeight:512});Y.position.z+=200,Y.position.y-=110,Y.rotation.x=-.5*Math.PI,this.scene.add(Y),this.cameraTargetPosition=new a["Fb"](0,0,this.cameraZPosition),this.camera.position.copy(this.cameraTargetPosition),this.camera.lookAt(0,0,0),this.cameraWithMouseMoveFactor=.04,this.cameraWithMouseRotateFactor=.015,this.cameraPositionController=new pe["b"](this.camera.position,.5,.05),window.addEventListener("mousemove",(function(e){$.onMouseMove(e)})),this.cursorLightGroup=new a["D"],this.cursorLight=new a["gb"],this.cursorLight.intensity=1,this.cursorLight.decay=1,this.cursorLight.distance=200,this.cursorLight.color=new a["m"](11193599),this.cursorLightGroup.add(this.cursorLight),this.scene.add(this.cursorLightGroup),this.cursorLightController=new pe["a"](this.cursorLightGroup,.3,.1),this.raycaster=new a["lb"],this.intersectTardisCardObjs=[],this.intersectTardisCardObjs.push(M.cardMesh,T.cardMesh,W.cardMesh,G.cardMesh),this.intersectGlassObjs=[],this.glassSelected=void 0,this.glassIsRotating=!1,this.intersectGlassObjs.push(m),this.mousePosX=0,this.mousePosY=0,this.pointer=new a["Eb"];var $=this;window.addEventListener("resize",(function(){$.onWindowResize()})),window.addEventListener("click",(function(e){$.onClick(e)})),this.animate()}return Object(c["a"])(e,[{key:"render",value:function(){this.composer.render(),this.renderer.clearDepth(),this.refractionManager.render(),this.cssRenderer&&this.cssRenderer.render(this.cssScene,this.camera)}},{key:"onWindowResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.refractionManager.onWindowResize(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.composer.setSize(window.innerWidth,window.innerHeight),this.cssRenderer&&this.cssRenderer.setSize(window.innerWidth,window.innerHeight)}},{key:"onMouseMove",value:function(e){var t=this;this.mousePosX=e.clientX,this.mousePosY=e.clientY,this.pointer.x=e.clientX/window.innerWidth*2-1,this.pointer.y=-e.clientY/window.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);var r=this.raycaster.intersectObjects(this.intersectGlassObjs,!1);if(1!=r.length||this.glassIsRotating||this.glassSelected===r[0].object.parent){if(0==r.length&&!this.glassIsRotating&&void 0!==this.glassSelected){console.log("out"),this.glassIsRotating=!0;var n=this.glassSelected,i=this.glassSelected["refractionObject"];C["a"].tweenEuler(this.glassSelected.rotation,new a["x"](1,1,1),(function(e){n.rotation.copy(e)}),(function(){t.glassIsRotating=!1}),500),C["a"].tweenNumber(0,1,(function(e){i.refractionMaterialUniforms["absorbColor"].value.b=e}),(function(){}),500),this.glassSelected=void 0}}else{console.log("in"),this.glassIsRotating=!0;var o=r[0].object.parent,s=o?o["refractionObject"]:null;o instanceof a["T"]&&s instanceof me["b"]&&(this.glassSelected=o,C["a"].tweenEuler(this.glassSelected.rotation,new a["x"](1,6,1),(function(e){o.rotation.copy(e)}),(function(){t.glassIsRotating=!1}),500),C["a"].tweenNumber(1,0,(function(e){s.refractionMaterialUniforms["absorbColor"].value.b=e}),(function(){}),500))}}},{key:"onClick",value:function(e){var t=this;if(!this.glassSelected){var r=this.raycaster.intersectObjects(this.intersectTardisCardObjs,!1);if(1==r.length){var n=r[0];C["a"].tweenThreeVector3(this.cameraTargetPosition,new a["Fb"](n.object.position.x,n.object.position.y,this.cameraTargetPosition.z),(function(e){t.cameraTargetPosition.copy(e)}),(function(){}),750),this.carousel1.clickToRotate(this.raycaster,(function(e){return console.log("new carousel img index",e),"https://picsum.photos/id/".concat(Math.ceil(50*Math.random()),"/200/200")})),this.carousel2.clickToChangeTex(this.raycaster,(function(e){return console.log("new carousel img index",e),"https://picsum.photos/id/".concat(Math.ceil(50*Math.random()),"/200/200")}))}}}},{key:"getRaycastPos",value:function(e,t){var r=2*e/window.innerWidth-1,n=1-2*t/window.innerHeight,i=new a["Fb"](r,n,.995);return i.unproject(this.camera),i}},{key:"updatecornerObject",value:function(){var e=this.getRaycastPos(window.innerWidth-200,window.innerHeight/2);this.glassMesh1Controller.update(e)}},{key:"updateCamera",value:function(){var e=window.innerWidth/2-this.mousePosX,t=window.innerHeight/2-this.mousePosY,r=new a["Fb"](-e*this.cameraWithMouseMoveFactor,t*this.cameraWithMouseMoveFactor,0).add(this.cameraTargetPosition);this.cameraPositionController.update(r);var n=this.cameraPositionController.velocity;this.camera.rotation.x=n.y*this.cameraWithMouseRotateFactor,this.camera.rotation.y=-n.x*this.cameraWithMouseRotateFactor}},{key:"updateCursorLight",value:function(){if(!isNaN(this.mousePosX)&&!isNaN(this.mousePosY)){var e=this.getRaycastPos(this.mousePosX,this.mousePosY),t=this.camera.position.z,r=(new a["Fb"]).copy(e);r=r.sub(this.camera.position);var n=-200,i=(n-t)/r.z;e.copy(this.camera.position),r.multiplyScalar(i),e.add(r),e.z+=100,this.cursorLightController.update(e)}}},{key:"registerCSSCoordinator",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new a["Fb"],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;void 0==this.cssRenderer&&(this.cssRenderer=new ve["b"](e),this.cssRenderer.setSize(window.innerWidth,window.innerHeight));var i=new ve["a"](t);return i.position.copy(r),i.scale.multiplyScalar(n),this.cssScene.add(i),i}}]),e}(),ye=o["a"].extend({data:function(){return{fpm:null,loadingStat:{loaded:1,total:2,isLoaded:!1,noLoadingStat:!1}}},mounted:function(){var e=this,t=this;if(this.$refs["canvas-container"]instanceof HTMLElement){if(this.fpm=new we(this.$refs["canvas-container"],(function(){console.log("loaded"),t.loadingStat.isLoaded=!0,setTimeout((function(){t.loadingStat.noLoadingStat=!0}),501)}),(function(t,r,n){e.loadingStat.loaded=r,e.loadingStat.total=n}),(function(e){console.error("failed to load asset: "+e),t.loadingStat.isLoaded=!0})),this.$refs["dom3d-container"]instanceof HTMLElement&&this.$refs["dom3d-glass"]instanceof HTMLElement){var r=this.fpm.registerCSSCoordinator(this.$refs["dom3d-container"],this.$refs["dom3d-glass"],new a["Fb"](0,20,10));r.setFollowObject(this.fpm.glassMesh1Controller.object,new a["Fb"])}this.$refs["dom3d-container"]instanceof HTMLElement&&this.$refs["dom3d-test"]instanceof HTMLElement&&this.fpm.registerCSSCoordinator(this.$refs["dom3d-container"],this.$refs["dom3d-test"],new a["Fb"](-200,110,0))}},methods:{onGlassClick:function(){alert("glass clicked!")}}}),xe=ye,Me=(r("32a7"),r("2877")),Ce=Object(Me["a"])(xe,n,i,!1,null,"530f970e",null);t["default"]=Ce.exports},"4acd":function(e,t,r){},"4e82":function(e,t,r){"use strict";var n=r("23e7"),i=r("e330"),a=r("59ed"),o=r("7b0b"),s=r("07fa"),c=r("577e"),l=r("d039"),d=r("addb"),h=r("a640"),u=r("04d1"),f=r("d998"),g=r("2d00"),v=r("512c"),p=[],m=i(p.sort),b=i(p.push),w=l((function(){p.sort(void 0)})),y=l((function(){p.sort(null)})),x=h("sort"),M=!l((function(){if(g)return g<70;if(!(u&&u>3)){if(f)return!0;if(v)return v<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)p.push({k:t+n,v:r})}for(p.sort((function(e,t){return t.v-e.v})),n=0;n<p.length;n++)t=p[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}})),C=w||!y||!x||!M,j=function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}};n({target:"Array",proto:!0,forced:C},{sort:function(e){void 0!==e&&a(e);var t=o(this);if(M)return void 0===e?m(t):m(t,e);var r,n,i=[],c=s(t);for(n=0;n<c;n++)n in t&&b(i,t[n]);d(i,j(e)),r=i.length,n=0;while(n<r)t[n]=i[n++];while(n<c)delete t[n++];return t}})},"512c":function(e,t,r){var n=r("342f"),i=n.match(/AppleWebKit\/(\d+)\./);e.exports=!!i&&+i[1]},5303:function(e,t,r){var n={"./GlassFrontShader/V.glsl":"c444"};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id="5303"},7612:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("5a89");const i=new n["Fb"];function a(e,t,r,n,a,o){const s=2*Math.PI*a/4,c=Math.max(o-2*a,0),l=Math.PI/4;i.copy(t),i[n]=0,i.normalize();const d=.5*s/(s+c),h=1-i.angleTo(e)/l;if(1===Math.sign(i[r]))return h*d;{const e=c/(s+c);return e+d+d*(1-h)}}class o extends n["g"]{constructor(e=1,t=1,r=1,i=2,o=.1){if(i=2*i+1,o=Math.min(e/2,t/2,r/2,o),super(1,1,1,i,i,i),1===i)return;const s=this.toNonIndexed();this.index=null,this.attributes.position=s.attributes.position,this.attributes.normal=s.attributes.normal,this.attributes.uv=s.attributes.uv;const c=new n["Fb"],l=new n["Fb"],d=new n["Fb"](e,t,r).divideScalar(2).subScalar(o),h=this.attributes.position.array,u=this.attributes.normal.array,f=this.attributes.uv.array,g=h.length/6,v=new n["Fb"],p=.5/i;for(let n=0,m=0;n<h.length;n+=3,m+=2){c.fromArray(h,n),l.copy(c),l.x-=Math.sign(l.x)*p,l.y-=Math.sign(l.y)*p,l.z-=Math.sign(l.z)*p,l.normalize(),h[n+0]=d.x*Math.sign(c.x)+l.x*o,h[n+1]=d.y*Math.sign(c.y)+l.y*o,h[n+2]=d.z*Math.sign(c.z)+l.z*o,u[n+0]=l.x,u[n+1]=l.y,u[n+2]=l.z;const i=Math.floor(n/g);switch(i){case 0:v.set(1,0,0),f[m+0]=a(v,l,"z","y",o,r),f[m+1]=1-a(v,l,"y","z",o,t);break;case 1:v.set(-1,0,0),f[m+0]=1-a(v,l,"z","y",o,r),f[m+1]=1-a(v,l,"y","z",o,t);break;case 2:v.set(0,1,0),f[m+0]=1-a(v,l,"x","z",o,e),f[m+1]=a(v,l,"z","x",o,r);break;case 3:v.set(0,-1,0),f[m+0]=1-a(v,l,"x","z",o,e),f[m+1]=1-a(v,l,"z","x",o,r);break;case 4:v.set(0,0,1),f[m+0]=1-a(v,l,"x","y",o,e),f[m+1]=1-a(v,l,"y","x",o,t);break;case 5:v.set(0,0,-1),f[m+0]=a(v,l,"x","y",o,e),f[m+1]=1-a(v,l,"y","x",o,t);break}}}}},"7d52":function(e,t,r){"use strict";r.d(t,"b",(function(){return w})),r.d(t,"a",(function(){return y})),r.d(t,"c",(function(){return x}));var n=r("3835"),i=r("bee2"),a=r("d4ec"),o=r("ade3"),s=(r("d3b7"),r("159b"),r("38cf"),r("5a89")),c=r("4721"),l=r("7612");function d(e){try{var t=r("5303")("./"+e+"/V.glsl"),n=r("08fd")("./"+e+"/F.glsl");return[t,n]}catch(i){return console.error("failed to fetch shader",i),["",""]}}var h,u,f,g,v,p,m,b=r("61d9"),w=Object(i["a"])((function e(t,r,i,c,l,h,u,f,g,v){if(Object(a["a"])(this,e),Object(o["a"])(this,"mesh",void 0),Object(o["a"])(this,"originalMaterial",void 0),Object(o["a"])(this,"refractionMaterial",void 0),Object(o["a"])(this,"backColor",void 0),Object(o["a"])(this,"refractionMaterialUniforms",void 0),this.mesh=r,this.mesh["refractionObject"]=this,this.mesh.material instanceof Array){this.originalMaterial=new Array;for(var p=0;p<this.mesh.material.length;p++)this.originalMaterial.push(this.mesh.material[p].clone())}else this.originalMaterial=this.mesh.material.clone();this.backColor=u,this.refractionMaterialUniforms={resolution:{value:i},tBackground:{value:c},tBackDepth:{value:h},tDisplayImage:{value:l},tSkybox:{value:t.environment},refractionFactor:{value:g},opacity:{value:v},absorbColor:{value:new s["m"](f)},objectCenter:{value:r.position}};var m=d("GlassFrontShader"),b=Object(n["a"])(m,2),w=b[0],y=b[1];this.refractionMaterial=new s["qb"]({vertexShader:w,fragmentShader:y,uniforms:this.refractionMaterialUniforms,side:s["C"]})})),y=function(){function e(t,r,n,i){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512;Object(a["a"])(this,e),Object(o["a"])(this,"container",void 0),Object(o["a"])(this,"backgroundScene",void 0),Object(o["a"])(this,"renderer",void 0),Object(o["a"])(this,"camera",void 0),Object(o["a"])(this,"frontScene",void 0),Object(o["a"])(this,"backdepthTexture",void 0),Object(o["a"])(this,"backRenderTarget",void 0),Object(o["a"])(this,"refractionObjectList",void 0),Object(o["a"])(this,"suResolution",void 0),this.container=r,this.backgroundScene=t,this.renderer=n,this.camera=i,this.frontScene=new s["ob"],this.backdepthTexture=new s["r"](c,c,s["B"]),this.backRenderTarget=new s["Jb"](this.container.offsetWidth*window.devicePixelRatio,this.container.offsetHeight*window.devicePixelRatio),this.backRenderTarget.depthBuffer=!0,this.backRenderTarget.depthTexture=this.backdepthTexture,this.backRenderTarget.depthTexture.type=s["Db"],this.frontScene.background=this.backRenderTarget.texture,this.frontScene.environment=this.backgroundScene.environment,this.refractionObjectList=[],this.suResolution=new s["Eb"](this.container.offsetWidth*window.devicePixelRatio,this.container.offsetHeight*window.devicePixelRatio)}return Object(i["a"])(e,[{key:"genFresnelMaterial",value:function(e){var t=s["pb"].lib["fresnel"],r=s["Cb"].clone(t.uniforms);r["tCube"].value=e;var n={fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r},i=new s["qb"](n);return i}},{key:"addRefractionMesh",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16777215,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1.49,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.2,c=new s["m"](n);t&&(e.material=new s["X"]({color:c,transparent:!0,opacity:.5,metalness:1,reflectivity:0,roughness:0,side:s["e"]})),this.refractionObjectList.push(new w(this.backgroundScene,e,this.suResolution,this.backRenderTarget.texture,r,this.backRenderTarget.depthTexture,c,i,a,o)),this.backgroundScene.add(e)}},{key:"onWindowResize",value:function(){this.suResolution.x=this.container.offsetWidth*window.devicePixelRatio,this.suResolution.y=this.container.offsetHeight*window.devicePixelRatio}},{key:"render",value:function(){var e=this;this.refractionObjectList.forEach((function(t){t.mesh.material=t.refractionMaterial,e.frontScene.add(t.mesh)})),this.renderer.setRenderTarget(null),this.renderer.render(this.frontScene,this.camera),this.refractionObjectList.forEach((function(t){t.mesh.material=t.originalMaterial,e.backgroundScene.add(t.mesh)}))}}]),e}();function x(e){h=e,f=new s["cb"](45,window.innerWidth/window.innerHeight,1,5e3),f.position.set(30,20,200),f.lookAt(0,0,0),p=new s["ob"],u=new s["Kb"]({antialias:!0,alpha:!0}),u.setClearColor(16777215),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),h.appendChild(u.domElement),g=new c["a"](f,h),h.style.position="absolute",h.style.top="0px",h.style.left="0px",v=new b["Stats"],v.domElement.style.zIndex="100",h.appendChild(v.domElement);var t="./cube/",r=[t+"px.jpg",t+"nx.jpg",t+"py.jpg",t+"ny.jpg",t+"pz.jpg",t+"nz.jpg"],n=(new s["o"]).load(r);n.mapping=s["n"],p.background=n,p.environment=n;var i=new s["s"];i.position.x=300,i.position.y=200,i.position.z=100,p.add(i);var a=(new s["zb"]).load("./checkerboard.jpg");a.wrapS=a.wrapT=s["mb"],a.repeat.set(10,10);var o=new s["U"]({map:a,side:s["t"]}),d=new s["fb"](1e3,1e3,1,1),w=new s["T"](d,o);w.position.y-=20.1,w.rotation.x=Math.PI/2,m=new y(p,h,u,f);var x=new s["T"](new l["a"](40,40,40,5,5),new s["W"]({}));x.position.x-=40;var j=new s["T"](new s["ub"](20),new s["W"]({})),O=new s["T"](new s["q"](20,20,80,36),new s["W"]({}));O.position.x+=40,O.position.y+=20,m.addRefractionMesh(x,!0,null,0,0),m.addRefractionMesh(j,!0,null,24576,24576),m.addRefractionMesh(O,!0,null,1587,1587);var k=new s["T"](new s["ub"](20),new s["W"]({color:16711680}));k.position.copy(x.position),k.position.z-=50,p.add(k),window.addEventListener("resize",M),C()}function M(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),m.onWindowResize(),u.setSize(window.innerWidth,window.innerHeight)}function C(){requestAnimationFrame(C),j(),g.update(),v.update()}function j(){m.render()}},"96cf":function(e,t,r){var n=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(_){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),o=new S(n||[]);return a._invoke=O(e,r,o),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(_){return{type:"throw",arg:_}}}e.wrap=l;var h="suspendedStart",u="suspendedYield",f="executing",g="completed",v={};function p(){}function m(){}function b(){}var w={};c(w,a,(function(){return this}));var y=Object.getPrototypeOf,x=y&&y(y(R([])));x&&x!==r&&n.call(x,a)&&(w=x);var M=b.prototype=p.prototype=Object.create(w);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(i,a,o,s){var c=d(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"===typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}var i;function a(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}this._invoke=a}function O(e,t,r){var n=h;return function(i,a){if(n===f)throw new Error("Generator is already running");if(n===g){if("throw"===i)throw a;return F()}r.method=i,r.arg=a;while(1){var o=r.delegate;if(o){var s=k(o,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var c=d(e,t,r);if("normal"===c.type){if(n=r.done?g:u,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=g,r.method="throw",r.arg=c.arg)}}}function k(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator["return"]&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=d(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function R(e){if(e){var r=e[a];if(r)return r.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){while(++i<e.length)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:F}}function F(){return{value:t,done:!0}}return m.prototype=b,c(M,"constructor",b),c(b,"constructor",m),m.displayName=c(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,s,"GeneratorFunction")),e.prototype=Object.create(M),e},e.awrap=function(e){return{__await:e}},C(j.prototype),c(j.prototype,o,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new j(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(M),c(M,s,"Generator"),c(M,a,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){while(t.length){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=R,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=n}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},a434:function(e,t,r){"use strict";var n=r("23e7"),i=r("da84"),a=r("23cb"),o=r("5926"),s=r("07fa"),c=r("7b0b"),l=r("65f0"),d=r("8418"),h=r("1dde"),u=h("splice"),f=i.TypeError,g=Math.max,v=Math.min,p=9007199254740991,m="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!u},{splice:function(e,t){var r,n,i,h,u,b,w=c(this),y=s(w),x=a(e,y),M=arguments.length;if(0===M?r=n=0:1===M?(r=0,n=y-x):(r=M-2,n=v(g(o(t),0),y-x)),y+r-n>p)throw f(m);for(i=l(w,n),h=0;h<n;h++)u=x+h,u in w&&d(i,h,w[u]);if(i.length=n,r<n){for(h=x;h<y-n;h++)u=h+n,b=h+r,u in w?w[b]=w[u]:delete w[b];for(h=y;h>y-n+r;h--)delete w[h-1]}else if(r>n)for(h=y-n;h>x;h--)u=h+n-1,b=h+r-1,u in w?w[b]=w[u]:delete w[b];for(h=0;h<r;h++)w[h+x]=arguments[h+2];return w.length=y-n+r,i}})},addb:function(e,t,r){var n=r("4dae"),i=Math.floor,a=function(e,t){var r=e.length,c=i(r/2);return r<8?o(e,t):s(e,a(n(e,0,c),t),a(n(e,c),t),t)},o=function(e,t){var r,n,i=e.length,a=1;while(a<i){n=a,r=e[a];while(n&&t(e[n-1],r)>0)e[n]=e[--n];n!==a++&&(e[n]=r)}return e},s=function(e,t,r,n){var i=t.length,a=r.length,o=0,s=0;while(o<i||s<a)e[o+s]=o<i&&s<a?n(t[o],r[s])<=0?t[o++]:r[s++]:o<i?t[o++]:r[s++];return e};e.exports=a},b64b:function(e,t,r){var n=r("23e7"),i=r("7b0b"),a=r("df75"),o=r("d039"),s=o((function(){a(1)}));n({target:"Object",stat:!0,forced:s},{keys:function(e){return a(i(e))}})},c444:function(e,t){e.exports="varying vec2 vUv;\r\nvarying vec3 vNormal;\r\nvarying vec3 vCameraPosition;\r\nvarying vec4 vWorldPosition;\r\nvarying mat4 vProjectionMatrix;\r\n// varying vec3 vRefract;\r\n// varying vec2 vRefractOffset;\r\nvarying vec4 vImageUVCenter;\r\n\r\nuniform vec3 objectCenter;\r\n\r\n\r\nvoid main() {\r\n    vWorldPosition = modelMatrix * vec4( position, 1.0 );\r\n    vec4 mvPosition = viewMatrix * vWorldPosition;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n    vUv = uv;\r\n\r\n    vNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\r\n    vCameraPosition = cameraPosition;\r\n\r\n    vProjectionMatrix = projectionMatrix * modelViewMatrix;\r\n    vImageUVCenter = vProjectionMatrix * vec4( objectCenter, 1.0 );\r\n}\r\n"},d81d:function(e,t,r){"use strict";var n=r("23e7"),i=r("b727").map,a=r("1dde"),o=a("map");n({target:"Array",proto:!0,forced:!o},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},d998:function(e,t,r){var n=r("342f");e.exports=/MSIE|Trident/.test(n)},f430:function(e,t){e.exports="uniform vec2 resolution;\r\nuniform sampler2D tBackground;\r\nuniform sampler2D tBackDepth;\r\nuniform sampler2D tDisplayImage;\r\n\r\nuniform samplerCube tSkybox;\r\nuniform vec3 absorbColor;\r\nuniform float refractionFactor;\r\nuniform float opacity;\r\n\r\nvarying vec2 vUv;\r\nvarying vec3 vNormal;\r\nvarying vec3 vCameraPosition;\r\nvarying vec4 vWorldPosition;\r\nvarying mat4 vProjectionMatrix;\r\nvarying vec4 vImageUVCenter;\r\n\r\nfloat near = 0.1;\r\nfloat far  = 5000.0;\r\n\r\nfloat LinearizeDepth(float depth) \r\n{\r\n    float z = depth * 2.0 - 1.0; // back to NDC \r\n    return (2.0 * near * far) / (far + near - z * (far - near));\t\r\n}\r\n\r\nvoid main() {\r\n\r\n    // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r\n    // return;\r\n    float backDepth = float(texture2D( tBackDepth, vec2( gl_FragCoord.x / resolution.x, gl_FragCoord.y / resolution.y ) ).x);\r\n    float frontDepth = gl_FragCoord.z;\r\n\r\n    if (frontDepth > backDepth) {\r\n        discard;\r\n    }\r\n\r\n    float backDepthlinear = LinearizeDepth(backDepth);\r\n    float frontDepthlinear = LinearizeDepth(frontDepth);\r\n    \r\n    float backToFrontDepth = backDepthlinear - frontDepthlinear;\r\n    backToFrontDepth *= 0.5;\r\n    \r\n    vec3 vCameraRay = vWorldPosition.xyz / vWorldPosition.w - vCameraPosition;\r\n    vCameraRay = normalize(vCameraRay);\r\n    vec3 vRefract = refract( vCameraRay, vNormal, 1.0 / refractionFactor );\r\n    vec4 vOriginalPos = vWorldPosition + vec4(vCameraRay, 0.0);\r\n    vec4 vRefractedPos = vWorldPosition + vec4(vRefract, 0.0);\r\n    // vRefractedPos = vOriginalPos; //vWorldPosition + vec4(vRefract, 0.0);\r\n    vec4 vOriginalProjectedPos = vProjectionMatrix * vOriginalPos;\r\n    vec4 vRefractedProjectedPos = vProjectionMatrix * vRefractedPos;\r\n    vec2 offset = normalize(vRefractedProjectedPos - vOriginalProjectedPos).xy;\r\n    offset = normalize(offset);\r\n\r\n    // reflect\r\n    vec3 vReflect = reflect( vCameraRay, vNormal );\r\n    vec3 refCol = vec3(textureCube(tSkybox, vReflect));\r\n\r\n    // snell's law\r\n    float cosTheta1 = dot(vCameraRay, vNormal);\r\n    float sinTheta1 = 1.0 - cosTheta1 * cosTheta1;\r\n    float sinTheta2 = sinTheta1 / refractionFactor;\r\n    float theta2 = asin(sinTheta2);\r\n    offset *= sinTheta2;\r\n    offset *= 100.0;\r\n\r\n    offset /= backDepth;\r\n\r\n    float samplePointX_r = (gl_FragCoord.x + backToFrontDepth * offset.x * 0.9) / resolution.x;\r\n    float samplePointY_r = (gl_FragCoord.y + backToFrontDepth * offset.y * 0.9) / resolution.y;\r\n\r\n    float samplePointX_g = (gl_FragCoord.x + backToFrontDepth * offset.x * 0.95) / resolution.x;\r\n    float samplePointY_g = (gl_FragCoord.y + backToFrontDepth * offset.y * 0.95) / resolution.y;\r\n\r\n    float samplePointX_b = (gl_FragCoord.x + backToFrontDepth * offset.x) / resolution.x;\r\n    float samplePointY_b = (gl_FragCoord.y + backToFrontDepth * offset.y) / resolution.y;\r\n    \r\n    float backColor_r = texture2D( tBackground, vec2( samplePointX_r, samplePointY_r ) * 1.0 ).x;\r\n    float backColor_g = texture2D( tBackground, vec2( samplePointX_g, samplePointY_g ) * 1.0 ).y;\r\n    float backColor_b = texture2D( tBackground, vec2( samplePointX_b, samplePointY_b ) * 1.0 ).z;\r\n\r\n    vec3 backColor = vec3(backColor_r, backColor_g, backColor_b);\r\n    vec3 absorbColor = absorbColor * sqrt(backToFrontDepth) * opacity;\r\n    float sqrtDepth = sqrt(backToFrontDepth) * opacity;\r\n    float absorbFactor = sqrtDepth / (1.0 + sqrtDepth);\r\n    vec3 refractCol = mix(backColor, absorbColor, absorbFactor);\r\n\r\n    // backColor = texture2D( tBackground, vec2( (gl_FragCoord.x + backToFrontDepth * offset.x) / resolution.x, (gl_FragCoord.y + backToFrontDepth * offset.y) / resolution.y ) * 1.0 ).xyz;\r\n\r\n    // gl_FragColor = vec4(refCol, 1.0);\r\n    float reflectionCoeff = pow(sinTheta1, 4.0);\r\n    // reflectionCoeff = 1.0;\r\n\r\n    // vec4 image = vec4(vec3(texture2D( tDisplayImage, vec2( (gl_FragCoord.x + vImageUVCenter.x) / resolution.x, (gl_FragCoord.y + vImageUVCenter.y) / resolution.y ) )), 1.0);\r\n    // vec4 image = vec4((gl_FragCoord.x + vImageUVCenter.x) / resolution.x, (gl_FragCoord.y + vImageUVCenter.y) / resolution.y, 1.0, 1.0);\r\n    // vec4 image = vec4(1.0, 0.0, 0.0, 1.0);\r\n\r\n    // gl_FragColor = vec4(mix(refractCol, refCol, reflectionCoeff), 1.0);\r\n    gl_FragColor = vec4(mix(refractCol, refCol, reflectionCoeff), 1.0);\r\n    // gl_FragColor = image;\r\n    // if (gl_FragCoord.x < 600.0) {\r\n    //     gl_FragColor = vec4(mix(refractCol, refCol, reflectionCoeff), 1.0);\r\n    // }\r\n    // gl_FragColor = vec4(backColor, 1.0);\r\n    // gl_FragColor = vec4(vec3(backDepthlinear * 0.01), 1.0);\r\n}"}}]);
//# sourceMappingURL=chunk-86717ca2.a441251c.js.map