(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a6f5fbd"],{5286:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-container"},[n("alert-snackbar"),n("v-card",{directives:[{name:"show",rawName:"v-show",value:e.mouseHintShow,expression:"mouseHintShow"}],staticClass:"pointer-tag pb-2 flex-column align-center",attrs:{color:"#80808080"}},[n("v-flex",{staticClass:"pa-2",domProps:{innerHTML:e._s(e.mouseHint)}}),n("v-btn",{attrs:{tile:""},on:{click:function(t){e.mouseHintShow=!1}}},[e._v(e._s(e.$t("m.i.gotIt")))])],1),n("div",{ref:"canvas-box",staticClass:"canvas-box"},[n("canvas",{ref:"main-canvas",attrs:{id:"main-canvas"},on:{mousedown:e.onCanvasMouseDown,mouseup:e.onCanvasClickedOrTouched,dblclick:e.onCanvasDblClick,touchstart:e.onCanvasTouchStart,touchend:e.onCanvasTouchEnd}})]),n("material-dialog",{attrs:{neuron:e.rightClickSelectedNeuron},on:{materialChanged:e.render},model:{value:e.rightClickMaterialDialogOpen,callback:function(t){e.rightClickMaterialDialogOpen=t},expression:"rightClickMaterialDialogOpen"}}),n("v-btn",{staticClass:"panels-toggle-btn",attrs:{color:"red",fab:""},on:{click:function(t){return t.stopPropagation(),e.togglePanel(t)}}},[n("v-icon",{attrs:{color:"white"}},[e._v(e._s(e.panelsOpen?"mdi-minus":"mdi-plus"))])],1),n("div",{staticClass:"panels-container elevation-3",class:{"panels-container-mobile":e.$store.state.isMobile},style:{"max-height":e.panelsOpen?"calc(100% - 40px)":"0"}},[e.sceneIsOn?n("div",{staticClass:"panels-wrapper"},[n("neuron-panel",{ref:"neuronPanel",attrs:{router:"viewer",camera:e.camera,controls:e.controls,neuronList:e.neuronList},on:{renderOnce:e.render}}),n("scene-panel",{ref:"scenePanel",attrs:{isViewer:!0,bgColor:e.bgColor,lights:e.lights,neuronList:e.neuronList},on:{reload:e.loadObj,downloadConfig:e.saveConfigJson,loadCanvas:e.loadCanvas,saveScreenshot:e.saveScreenshot,bgColorChanged:e.bgColorChanged,renderOnce:e.render,controlsTypeChanged:function(t){return e.controlsTypeChanged(t)}}})],1):e._e()])],1)},o=[],s=(n("4160"),n("b0c0"),n("b64b"),n("d3b7"),n("ac1f"),n("3ca3"),n("5319"),n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("ddb0"),n("5a89")),a=n("920c"),r=n("4721"),c=n("5a15"),l=n("bed6"),d=n("97f5"),h=n("062b"),u=n("8146"),g=n("07b4"),f=n("8a20"),v=n("b31f"),p=n("7ab8"),m=n("bc3a"),C=n.n(m),b=n("c4e3"),P=n.n(b),w=n("0083"),k=n.n(w),T={name:"MyCanvas",components:{AlertSnackbar:l["a"],MaterialDialog:u["a"],ScenePanel:d["a"],NeuronPanel:h["a"]},data:function(){return{modelPath:void 0,fov:30,near:.1,far:1e4,canvasWidth:600,canvasHeight:400,canvas:void 0,canvasBox:void 0,camera:void 0,scene:void 0,renderer:void 0,controls:void 0,three:void 0,bgColor:"#000000",blackColor:"#000000",sceneIsSet:!1,sceneIsFirstSet:!1,sceneIsOn:!0,panelsOpen:!1,lights:[{color:void 0,strength:1,outColor:void 0},{color:void 0,strength:.5,direction:new s["B"](1,0,0),outColor:void 0},{color:void 0,strength:.5,direction:new s["B"](-1,0,0),outColor:void 0}],loadedObj:void 0,neuronList:[],groupList:[],defaultGroupText:this.$t("m.i.defaultGroupText"),neuronCount:0,loadingProgress:0,individualUnzippingProgress:[],individualLoadingProgress:[],clickTimeoutId:0,pickScene:void 0,pickingTexture:new s["C"](1,1,{type:s["g"]}),pixelBuffer:new Float32Array(4),elementDict:{},rightClickMaterialDialogOpen:!1,rightClickSelectedNeuron:void 0,touchTimeStamp:0,tagList:[],cvsMouseOrTouchPosX:0,cvsMouseOrTouchPosY:0,fileList:[],mouseHint:this.$store.state.isMobile?this.$t("m.i.mouseHintMobile"):this.$t("m.i.mouseHintDesktop"),mouseHintShow:!0}},mounted:function(){this.canvas=this.$refs["main-canvas"],this.canvasBox=this.$refs["canvas-box"],window.onresize=this.render,window.onbeforeunload=function(e){var t=e||window.event;return t&&(e.returnValue=this.$t("m.a.qWindowsClose")),this.$t("m.a.qWindowsClose")},this.loadObj()},methods:{loadObj:function(){var e=this,t="/model/config.json";C.a.get("/configPath.txt").then((function(n){t=n.data,e.modelPath=t.replace(/\/[^/]+$/,"")})).finally((function(){C.a.get(t).then((function(t){e.sceneIsOn=!0,e.loadCanvas(t.data)}))}))},getRomoteZipFiles:function(e,t,n){var i=this;return new Promise((function(o,s){k.a.getBinaryContent(e,{callback:function(e,t){e?s(e):o(t)},progress:function(e){i.loadingProgress-=i.individualUnzippingProgress[t]/n,i.individualUnzippingProgress[t]=e.loaded/e.total,i.loadingProgress+=i.individualUnzippingProgress[t]/n}})})).then((function(e){return P.a.loadAsync(e)})).then((function(e){Object.keys(e.files);return e}))},loadCanvas:function(e){var t=this;this.sceneIsSet=!1,this.canvasWidth=this.canvasBox.getBoundingClientRect().width,this.canvasHeight=this.canvasBox.getBoundingClientRect().height,this.canvas.style.width=this.canvasWidth,this.canvas.style.height=this.canvasHeight,this.sceneIsFirstSet||(this.scene=new s["v"],this.pickScene=new s["v"],this.pickScene.background=new s["d"](0)),this.scene.children.length=[],this.pickScene.children.length=[],this.lights.forEach((function(t,n){if(e.scene){var i=e.scene.lighting[n];t.color=new s["d"](i.color),t.strength=i.strength}else t.color=new s["d"](1,1,1);t.outColor=new s["B"](t.color.r,t.color.g,t.color.b),t.outColor.multiplyScalar(t.strength)})),this.sceneIsFirstSet||(this.renderer=new s["D"]({canvas:this.canvas,antialias:!0,preserveDrawingBuffer:!0})),this.renderer.setSize(this.canvasWidth,this.canvasHeight),this.renderer.renderLists.dispose(),e.scene&&e.scene.camera?this.controlsTypeChanged(1,e.scene.camera,!0):this.controlsTypeChanged(1,void 0,!1),this.loadedObj&&this.loadedObj.children&&(this.loadedObj.children.forEach((function(e){null})),this.loadedObj=null),this.loadedObj=new s["p"],this.elementDict={},this.tagIdCount=500,this.tagList.length=0,e.tags&&e.tags.forEach((function(e){t.addTagToScene(e)})),this.panelsOpen=!1,this.mouseHintShow=!0,this.loadingProgress=0,this.$store.commit("loadingProgressChanged",this.loadingProgress),this.neuronList.length=0,this.fileList.length=0,this.groupList.length=0,this.neuronCount=0;var n=!1;if(e.groups)for(var i in e.groups)i==this.defaultGroupText&&(n=!0),this.groupList.push(i);n||this.groupList.push(this.defaultGroupText),this.$store.commit("loadingScreenFadeIn"),this.individualLoadingProgress=0;var o={},a=[],r=0;e.fileList.forEach((function(e,n){t.fileList.push(e);var i=g["a"].getFileType(e);".zip"==i&&(r+=1)})),r>0?(this.individualUnzippingProgress=new Float32Array(r),this.$store.state.loadingPhase=0):this.$store.state.loadingPhase=1;var c=0;e.fileList.forEach((function(e,n){t.fileList.push(e);var i=g["a"].getFileType(e);if(".zip"==i){var s=t.modelPath+"/objects/".concat(e);console.log(s);var l=t.getRomoteZipFiles(s,c,r).then((function(n){var i=Object.keys(n.files);i.forEach((function(i){var s=g["a"].getFileType(i);if(".obj"==s){var a=e+"_"+i,r=n.file(i).async("string");o[a]=r,t.individualLoadingProgress+=1}}))}));a.push(l),c+=1}else".obj"==i&&(t.individualLoadingProgress+=1)})),Promise.all(a).then((function(){console.log("unzipped")})).catch((function(e){t.$store.commit("alert",{content:t.$t("m.a.fileUnableToUnzip")+e,timeout:1e6})})).finally((function(){t.$store.state.loadingPhase=1,t.loadingProgress=0,t.$store.commit("loadingProgressChanged",t.loadingProgress),t.individualLoadingProgress=new Float32Array(t.individualLoadingProgress),t.loadModels(o,e)}))},loadModels:function(e,t){var n=this,i=[],o={},a=function(e){t.groups[e].forEach((function(t){o[t]=e}))};for(var r in t.groups)a(r);var c=0;Object.keys(e).forEach((function(s){var a=e[s],r=n.loadModelLocal(a,c,n.individualLoadingProgress.length).then((function(e){n.addLoadedResultsToObj(e,t,s,o)}));i.push(r),c+=1})),t.fileList.forEach((function(e,s){var a=g["a"].getFileType(e);if(".obj"==a){var r=n.loadModel(n.modelPath+"/objects/".concat(e),c,n.individualLoadingProgress.length).then((function(i){n.addLoadedResultsToObj(i,t,e,o)}));i.push(r),c+=1}})),Promise.all(i).then((function(){console.log("files loaded")})).catch((function(e){n.$store.commit("alert",{content:n.$t("m.a.fileUnableToLoad")+e,timeout:1e6})})).finally((function(){if(n.scene.add(n.loadedObj),!t.scene||!t.scene.camera){var e=new s["a"](n.loadedObj,16711680),i=e.geometry.boundingSphere;n.controlsTypeChanged(1,i,!1)}n.$store.commit("loadingScreenFadeOut"),n.sceneIsSet=!0,n.bgColor=t.scene?t.scene.background:"#000000",n.$refs["scenePanel"].bgColorVal=n.bgColor,n.bgColorChanged(n.bgColor),n.sceneIsFirstSet=!0,n.render()}))},loadModel:function(e,t,n){var i=this;return new Promise((function(o,s){(new c["a"]).load(e,o,(function(e){i.loadingProgress-=i.individualLoadingProgress[t]/n,i.individualLoadingProgress[t]=e.loaded/e.total,i.loadingProgress+=i.individualLoadingProgress[t]/n,i.$store.commit("loadingProgressChanged",i.loadingProgress)}),(function(t){s(e)}))}))},loadModelLocal:function(e,t,n){var i=this;return new Promise((function(o,s){e.then((function(e){(new c["a"]).loadStr(e,o,(function(e){i.loadingProgress-=i.individualLoadingProgress[t]/n,i.individualLoadingProgress[t]=e.loaded/e.total,i.loadingProgress+=i.individualLoadingProgress[t]/n,i.$store.commit("loadingProgressChanged",i.loadingProgress)}),(function(e){s()}))}))}))},addLoadedResultsToObj:function(e,t,n,i){var o=this;e.children.forEach((function(e,s){o.neuronCount+=1;var a=o.neuronCount+1,r=g["a"].sansFileType(n);s>0&&(r+="_"+(s+1));var c=t.aliases&&t.aliases[r]||r;e.name=c;var l=1,d="#b0b0b0",h="#000000",u=16,v=!0,p=t.materials?t.materials[c]:void 0;p&&(l=p.type,d=p.primaryColor,h=p.secondaryColor,u=p.shininess,v=1==p.visible),e.material=f["a"](o.camera,a/1e3,o.lights,{type:l,primaryColor:d,secondaryColor:h,shininess:u}),e.visible=v;var m={index:a,group:i[c]||o.defaultGroupText,originalName:r,name:c,neuron:e};o.neuronList.push(m),o.elementDict[a]=m,o.loadedObj.add(e)}))},addTagToScene:function(e){var t=this.tagIdCount;this.tagIdCount+=1;var n=Object(v["a"])(e.text,{fontSize:e.fontSize,fontColor:e.fontColor,fontBold:e.fontBold,fontItalic:e.fontItalic,textAlign:e.textAlign,borderThickness:e.borderThickness,borderColor:e.hasBorder?e.borderColor:"#00000000",borderRadius:e.borderRadius,backgroundColor:e.hasBackground?e.backgroundColor:"#00000000"},t/1e3),i=n.sprite;i.position.set(e.position[0],e.position[1],e.position[2]),e.sprite=i,e.ruler=n.ruler,e.canvas=n.canvas,e.idValue=t,this.elementDict[t]=e,this.tagList.push(e),this.loadedObj.add(i)},controlsTypeChanged:function(e,t,n){n&&t&&void 0!==t.type&&(e=t.type),this.camera||(this.camera=new s["q"](this.fov,this.canvasWidth/this.canvasHeight,this.near,this.far));var i=new s["B"];n?i.fromArray(t.position):t?i.set(t.center.x-2*t.radius,t.center.y,t.center.z):i.copy(this.camera.position);var o=new s["B"];n?o.fromArray(t.target):t?o.set(t.center.x,t.center.y,t.center.z):this.controls&&o.copy(this.controls.target),this.controls&&this.controls.dispose();var c=new s["B"];if(n?c.fromArray(t.up):c.copy(this.camera.up),this.camera.position.copy(i),this.camera.up.copy(c),this.camera.updateProjectionMatrix(),0==e)this.camera.up.set(0,1,0),this.controls=new r["a"](this.camera,this.canvas);else{this.controls=new a["a"](this.camera,this.canvas),this.controls.staticMoving=!0;var l=.5;n&&t.panSpeed&&(l=t.panSpeed),this.controls.panSpeed=l}this.controls.target.copy(o),this.controls.removeEventListener("change",this.render),this.controls.addEventListener("change",this.render),this.controls.update(),this.$store.commit("setControls",this.controls)},renderNeedsResize:function(){this.canvasWidth=this.canvasBox.getBoundingClientRect().width,this.canvasHeight=this.canvasBox.getBoundingClientRect().height;var e=this.canvas.width!==this.canvasWidth||this.canvas.height!==this.canvasHeight;if(e)return[this.canvasWidth,this.canvasHeight]},render:function(){var e=this.renderNeedsResize();this.sceneIsSet&&(void 0!==e&&(this.renderer.setSize(e[0],e[1],!1),this.canvas.style.width=e[0]+"px",this.canvas.style.height=e[1]+"px",this.camera.aspect=this.canvas.clientWidth/this.canvas.clientHeight,this.camera.updateProjectionMatrix()),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera))},bgColorChanged:function(e){this.bgColor=e,this.renderer.setClearColor(this.bgColor,1),this.render()},onTransitionEnd:function(e){e.target.classList.remove("fade-in")},getCanvasRelativePosition:function(e){var t=this.canvas.getBoundingClientRect();return{x:(e.clientX-t.left)*this.canvas.width/t.width,y:(e.clientY-t.top)*this.canvas.height/t.height}},getClickInfo:function(e){var t=this.getClickInfoOnce(e);if(t[0])return t;for(var n=5,i={clientX:e.clientX,clientY:e.clientY},o=void 0,s=1;s<=n;s+=1){if(i.clientX-=s,o=this.getClickInfoOnce(i),o[0])return o;if(i.clientX+=2*s,o=this.getClickInfoOnce(i),o[0])return o;if(i.clientX-=s,i.clientY-=s,o=this.getClickInfoOnce(i),o[0])return o;if(i.clientY+=2*s,o=this.getClickInfoOnce(i),o[0])return o;i.clientY-=s}return t},getClickInfoOnce:function(e){var t=this.getCanvasRelativePosition(e),n=this.renderer.getPixelRatio();this.camera.setViewOffset(this.renderer.getContext().drawingBufferWidth,this.renderer.getContext().drawingBufferHeight,t.x*n|0,t.y*n|0,1,1),this.renderer.setClearColor(this.blackColor,1),this.renderer.setRenderTarget(this.pickingTexture),this.renderer.antialias=!1,this.pickScene.add(this.loadedObj),this.loadedObj.children.forEach((function(e){e.material.uniforms.isInfo.value=!0})),this.renderer.render(this.pickScene,this.camera),this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,1,1,this.pixelBuffer);var i=Math.round(1e3*this.pixelBuffer[0]);return this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.bgColor,1),this.camera.clearViewOffset(),this.scene.add(this.loadedObj),this.loadedObj.children.forEach((function(e){e.material.uniforms.isInfo.value=!1})),this.renderer.antialias=!0,[this.elementDict[i],this.pixelBuffer[1],this.pixelBuffer[2],this.pixelBuffer[3]]},onCanvasMouseDown:function(e){e.preventDefault(),this.cvsMouseOrTouchPosX=e.clientX,this.cvsMouseOrTouchPosY=e.clientY},onCanvasTouchStart:function(e){this.touchTimeStamp=e.timeStamp,this.cvsMouseOrTouchPosX=e.touches[0].clientX,this.cvsMouseOrTouchPosY=e.touches[0].clientY},onCanvasTouchEnd:function(e){this.touchTimeStamp=e.timeStamp-this.touchTimeStamp,this.onCanvasClickedOrTouched(e.changedTouches[0])},onCanvasDblClick:function(e){clearTimeout(this.clickTimeoutId);var t=this.getClickInfo(e);t[0]&&(void 0!==t[0].neuron?(this.controls.target.set(t[1],t[2],t[3]),this.controls.update()):(this.controls.target.fromArray(t[0].position),this.controls.update()))},onCanvasClickedOrTouched:function(e){var t=this;e.preventDefault&&e.preventDefault(),e.clientX===this.cvsMouseOrTouchPosX&&e.clientY===this.cvsMouseOrTouchPosY&&(clearTimeout(this.clickTimeoutId),this.clickTimeoutId=setTimeout((function(){var n=t.getClickInfo(e);n[0]&&void 0!==n[0].neuron&&(2==e.button?n[0]&&(t.rightClickMaterialDialogOpen=!0,t.rightClickSelectedNeuron=n[0].neuron):t.touchTimeStamp<300?t.$refs["neuronPanel"].neuronPicked(n[0]):(t.rightClickMaterialDialogOpen=!0,t.rightClickSelectedNeuron=n[0].neuron))}),200))},saveConfigJson:function(){try{new Blob}catch(c){this.$store.commit("alert",{content:this.$t("m.a.browserVersionTooOld")})}var e={};e.useZip=this.useZip,e["fileList"]=this.fileList;var t={},n={},i={};this.groupList.forEach((function(e){n[e]=[]})),this.neuronList.forEach((function(e){var o=n[e.group];void 0!=o?o.push(e.neuron.name):n[e.group]=[e.neuron.name],t[e.originalName]=e.neuron.name;var s=e.neuron.material;i[e.neuron.name]={type:s.uniforms.type.value,primaryColor:"#"+s.uniforms.primaryColor.value.getHexString(),secondaryColor:"#"+s.uniforms.secondaryColor.value.getHexString(),shininess:s.uniforms.shininess.value,visible:e.neuron.visible}})),e["aliases"]=t,e["groups"]=n,e["materials"]=i;var o=[];this.lights.forEach((function(e){o.push({color:"#"+e.color.getHexString(),strength:e.strength})}));var s={position:this.camera.position.toArray(),target:this.controls.target.toArray()};e["scene"]={background:this.bgColor,lighting:o,camera:s};var a=[];this.tagList.forEach((function(e){a.push({position:e.position,text:e.text,fontItalic:e.fontItalic,fontBold:e.fontBold,fontSize:e.fontSize,textAlign:e.textAlign,fontColor:e.fontColor,hasBorder:e.hasBorder,borderColor:e.borderColor,borderRadius:e.borderRadius,borderThickness:e.borderThickness,hasBackground:e.hasBackground,backgroundColor:e.backgroundColor})})),e["tags"]=a;var r=JSON.stringify(e,null,4);Object(p["a"])(r,"config.json","text/plain")},saveScreenshot:function(){var e="image/jpeg",t=this.renderer.domElement.toDataURL(e),n=document.createElement("a");n.download="neuron.png",n.href=t,n.click()},togglePanel:function(e){this.panelsOpen=!this.panelsOpen,e.target.blur()}},beforeDestroy:function(){window.removeEventListener("resize",this.render)}},y=T,O=(n("7c43"),n("2877")),S=n("6544"),x=n.n(S),L=n("8336"),B=n("b0af"),j=n("0e8f"),I=n("132d"),M=Object(O["a"])(y,i,o,!1,null,"571896aa",null);t["default"]=M.exports;x()(M,{VBtn:L["a"],VCard:B["a"],VFlex:j["a"],VIcon:I["a"]})},"7c43":function(e,t,n){"use strict";n("928c")},"928c":function(e,t,n){}}]);
//# sourceMappingURL=chunk-4a6f5fbd.0fab81e4.js.map