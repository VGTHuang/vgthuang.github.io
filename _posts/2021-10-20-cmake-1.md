---

layout: post
title: "CMake Notes #1"
author: "VGTHuang"
tags: cmake
excerpt_text: "Beginner's notes"

---

## A simple demo

A simple demo of what CMake does:

```
│  CMakeLists.txt
│  main.cpp
```

`CMakeLists.txt`:

```cmake
# CMake is not case-sensitive.

# Require a minimum version of cmake.
cmake_minimum_required(VERSION 3.1)

# Set the name of the project.
project(demo)

# Add an executable to the project using the specified source files.
ADD_EXECUTABLE(hello ${DIR_SRCS})
```

`main.cpp`:

```cpp
#include <stdio.h>

int main()
{
    printf("hello cmake");
    return 0;
}
```

What CMake does is to select a generator that generates the project based on these files above. For example, if a "Visual Studio 15 2017" generator is selected, CMake would first create a Visual Studio solution (.sln file and other auxiliary resources), then compile it into an executable file (`hello.exe`) with compiler provided by Visual Studio.

Run the following commands:

- List all usable generators for CMake

  ```
  cmake -G
  ```

- Configure and generate: generates a solution (if Visual Studio generator is selected)
  
  ```
  mkdir build
  cd build
  cmake ..
  ```

- Compile the executable file

  ```
  cmake --build ..
  ```

Or we can use CMake GUI to build the project with separated "configure" and "generate" functions. In the configure stage, it looks up all `CMakeList.txt` files and builds up an internal representation of the project. Then it generates the project files based on the representation. In command line mode, `cmake` command combines the two stages.

https://stackoverflow.com/questions/39401003/why-there-are-two-buttons-in-gui-configure-and-generate-when-cli-does-all-in-one

## Commonly used features

https://www.hahack.com/codes/cmake/

### Multiple source files within the same directory

```
│  CMakeLists.txt
│  main.cpp
│  foo.h
│  foo.cpp
```

```cmake
# CMakeFiles.txt


# ----------------------- version 1 -----------------------

cmake_minimum_required (VERSION 3.1)

project(demo)

ADD_EXECUTABLE(hello main.cpp foo.cpp)


# ----------------------- version 2 -----------------------

cmake_minimum_required (VERSION 3.1)

project(demo)

# look up all source files in the directory (main.cpp, math.cpp)
# and save them in variable DIR_SRCS
aux_source_directory(. DIR_SRCS)

ADD_EXECUTABLE(hello ${DIR_SRCS})
```

```cpp
// ----------------------- main.cpp -----------------------

#include "foo.h"

int main()
{
    doFoo();
    return 0;
}

// ----------------------- foo.h -----------------------
#ifndef FOO
#define FOO

void doFoo();

#endif

// ----------------------- foo.cpp -----------------------
#include<iostream>

void doFoo() {
    std::cout << "foo!\n";
}
```

### Multiple source files within multiple directories

```
│  CMakeLists.txt
│  main.cpp
│
└─foo_stuff
        CMakeList.txt
        foo.cpp
        foo.h
```

All sub-directories must contain its own `CMakeList.txt` file.

```cmake
# -----------------------  ./CMakeLists.txt -----------------------

cmake_minimum_required (VERSION 3.1)

project(demo)

aux_source_directory(. DIR_SRCS)

add_executable(hello ${DIR_SRCS})

# add subdirectory (for CMake to look up CMakeFiles.txt)
add_subdirectory(foo_stuff)

# next we need to add link library "FooLib"
# to the target "hello". The library FooLib is
# defined in the other CMakeLists.txt file
target_link_libraries(hello FooLib)

# -----------------------  ./foo_stuff/CMakeLists.txt -----------------------
aux_source_directory(. DIR_LIB_SRCS)

# a library instead of exe
add_library (FooLib ${DIR_LIB_SRCS})
```

```cpp
#include "foo_stuff/foo.h"
```

